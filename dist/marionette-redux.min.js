// Marionette Redux
// ----------------------------------
// v0.3.1
//
// Copyright (c)2017 Andrew Henderson.
// Distributed under MIT license
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("underscore"),require("marionette")):"function"==typeof define&&define.amd?define(["underscore","marionette"],i):t.MarionetteRedux=i(t._,t.Marionette)}(this,function(t,i){"use strict";function e(){return{}}function s(t){return{dispatch:t}}function n(i,e,s){return t.extend({},s,i,e)}function r(e){return t.isFunction(e)?e.prototype instanceof i.View||e.prototype instanceof i.Behavior:!!t.isObject(e)&&(e instanceof i.View||e instanceof i.Behavior)}function o(i,o,h,p){var c=p||{};return function(p){var u=i||p.prototype.mapStateToProps||e,d=o||p.prototype.mapDispatchToProps||s,f=h||p.prototype.mergeProps||n,l=c.store||p.prototype.store,P=p.prototype.initialize,g=p.prototype.onRender,S=p.prototype.onDestroy,v=t.defaults({},{initialize:function(t){var i=t||{};a.initialize.call(this,{mapStateToProps:u,mapDispatchToProps:d,mergeProps:f,store:l,props:i.props}),P&&P.apply(this,arguments)},onRender:function(){a.onRender.apply(this,arguments),g&&g.apply(this,arguments)},onDestroy:function(){a.onDestroy.apply(this,arguments),S&&S.apply(this,arguments)}},a);return r(p)||(v=t.omit(v,"onRender")),p.extend(v)}}var a={initialize:function(i){var o=i||{};this.mapState=o.mapStateToProps||this.mapStateToProps||e,this.mapDispatch=o.mapDispatchToProps||this.mapDispatchToProps||s,this.mergeProps=o.mergeProps||this.mergeProps||n,this.props=this.props||{},o.props&&t.extend(this.props,o.props),this.store=o.store||this.store,!this.store&&window&&window.store&&(this.store=window.store);var a=this.store.getState();this.state=t.defaults({storeState:a},this.getInitialState()),this.bindStateEvents(),this.clearCache(),r(this)||this.trySubscribe()},getInitialState:function(){return{}},setState:function(i,e,s){if(null==i)return this;var n=void 0;t.isObject(i)?(n=i,s=e):(n={})[i]=e,s||(s={});var o=s.unset,a=s.silent,h=[],p=this._changing;this._changing=!0,p||(this._previousState=t.clone(this.state),this.changed={});var c=this.state,u=this.changed,d=this._previousState;if(t.each(n,function(i,e){t.isEqual(c[e],i)||h.push(e),t.isEqual(d[e],i)?delete u[e]:u[e]=i,o?delete c[e]:c[e]=i}),!a){h.length&&(this._pending=s);for(var f=0;f<h.length;f++)this.trigger("change:"+h[f],this,c[h[f]],s)}if(p)return this;if(!a)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s),r(this)&&this.triggerDomRefresh!==!1&&this.triggerMethod("dom:refresh");return this._pending=!1,this._changing=!1,this},getState:function(t){return this.state[t]},bindStateEvents:function(){var t=i.bindEvents||i.bindEntityEvents;this.stateEvents&&t(this,this,this.stateEvents)},unbindStateEvents:function(){var t=i.unbindEvents||i.unbindEntityEvents;this.stateEvents&&t(this,this,this.stateEvents)},computeStateProps:function(t,i){if(!this.finalMapStateToProps)return this.configureFinalMapState(t,i);var e=t.getState(),s=this.doStatePropsDependOnOwnProps?this.finalMapStateToProps(e,i):this.finalMapStateToProps(e);return s},configureFinalMapState:function(i,e){var s=this.mapState(i.getState(),e),n=t.isFunction(s);return this.finalMapStateToProps=n?s:this.mapState,this.doStatePropsDependOnOwnProps=1!==this.finalMapStateToProps.length,n?this.computeStateProps(i,e):s},updateStatePropsIfNeeded:function(){var i=this.computeStateProps(this.store,this.props);return(!this.stateProps||!t.isEqual(i,this.stateProps))&&(this.stateProps=i,!0)},computeDispatchProps:function(t,i){if(!this.finalMapDispatchToProps)return this.configureFinalMapDispatch(t,i);var e=t.dispatch,s=this.doDispatchPropsDependOnOwnProps?this.finalMapDispatchToProps(e,i):this.finalMapDispatchToProps(e);return s},configureFinalMapDispatch:function(i,e){var s=this.mapDispatch(i.dispatch,e),n=t.isFunction(s);return this.finalMapDispatchToProps=n?s:this.mapDispatch,this.doDispatchPropsDependOnOwnProps=1!==this.finalMapDispatchToProps.length,n?this.computeDispatchProps(i,e):s},updateDispatchPropsIfNeeded:function(){var i=this.computeDispatchProps(this.store,this.props);return(!this.dispatchProps||!t.isEqual(i,this.dispatchProps))&&(this.dispatchProps=i,!0)},isSubscribed:function(){return t.isFunction(this.unsubscribe)},trySubscribe:function(){this.isSubscribed()||(this.unsubscribe=this.store.subscribe(this.handleChange.bind(this)),this.handleDispatchProps(),this.handleChange())},tryUnsubscribe:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},onRender:function(){this.trySubscribe()},onDestroy:function(){this.tryUnsubscribe(),this.unbindStateEvents(),this.clearCache()},clearCache:function(){this.dispatchProps=null,this.stateProps=null,this.finalMapDispatchToProps=null,this.finalMapStateToProps=null,this.haveInitialStatePropsBeenDetermined=!1,this.haveInitialDispatchPropsBeenDetermined=!1},handleDispatchProps:function(){this.haveInitialDispatchPropsBeenDetermined||(this.updateDispatchPropsIfNeeded(),this.haveInitialDispatchPropsBeenDetermined=!0)},handleChange:function(){if(this.unsubscribe){var i=this.store.getState(),e=this.getState("storeState");if(!this.haveInitialStatePropsBeenDetermined||!t.isEqual(e,i)){var s=this.updateStatePropsIfNeeded();if(this.haveInitialStatePropsBeenDetermined=!0,s){var n=this.mergeProps(this.stateProps,this.dispatchProps,this.props);this.props=n,t.isFunction(this.componentWillReceiveProps)&&this.componentWillReceiveProps(n),r(this)&&this._isRendered&&this.triggerDomRefresh!==!1&&this.triggerMethod("dom:refresh")}this.setState({storeState:i},{silent:!0})}}}},h="0.3.1",p={connect:o,mixin:a,VERSION:h};return p});
//# sourceMappingURL=marionette-redux.min.js.map
