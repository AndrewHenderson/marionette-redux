// Marionette Redux
// ----------------------------------
// v0.1.7
//
// Copyright (c)2016 Andrew Henderson.
// Distributed under MIT license
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("underscore"),require("backbone.marionette")):"function"==typeof define&&define.amd?define(["underscore","backbone.marionette"],i):t.MarionetteRedux=i(t._,t.Marionette)}(this,function(t,i){"use strict";function e(){return{}}function s(t){return{dispatch:t}}function n(i,e,s){return t.extend({},s,i,e)}function r(e){return t.isFunction(e)?e.prototype instanceof i.View||e.prototype instanceof i.Behavior:!!t.isObject(e)&&(e instanceof i.View||e instanceof i.Behavior)}function o(i,o,p,h){var c=h||{};return function(h){var u=i||h.prototype.mapStateToProps||e,d=o||h.prototype.mapDispatchToProps||s,f=p||h.prototype.mergeProps||n,l=c.store||h.prototype.store,P=h.prototype.initialize,S=h.prototype.onRender,v=h.prototype.onDestroy,b=t.defaults({},{initialize:function(t){var i=t||{};a.initialize.call(this,{mapStateToProps:u,mapDispatchToProps:d,mergeProps:f,store:l,props:i.props}),P&&P.apply(this,arguments)},onRender:function(){a.onRender.apply(this,arguments),S&&S.apply(this,arguments)},onDestroy:function(){a.onDestroy.apply(this,arguments),v&&v.apply(this,arguments)}},a);return r(h)||(b=t.omit(b,"onRender")),h.extend(b)}}var a={initialize:function(i){var o=i||{};this.mapState=o.mapStateToProps||this.mapStateToProps||e,this.mapDispatch=o.mapDispatchToProps||this.mapDispatchToProps||s,this.mergeProps=o.mergeProps||this.mergeProps||n,this.props=this.props||{},o.props&&t.extend(this.props,o.props),this.store=o.store||this.store,!this.store&&window&&window.store&&(this.store=window.store);var a=this.store.getState();this.state=t.defaults({storeState:a},this.getInitialState()),this.bindStateEvents(),this.clearCache(),r(this)||this.trySubscribe()},getInitialState:function(){return{}},setState:function(i,e,s){if(null==i)return this;var n=void 0;t.isObject(i)?(n=i,s=e):(n={})[i]=e,s||(s={});var r=s.unset,o=s.silent,a=[],p=this._changing;this._changing=!0,p||(this._previousState=t.clone(this.state),this.changed={});var h=this.state,c=this.changed,u=this._previousState;if(t.each(n,function(i,e){t.isEqual(h[e],i)||a.push(e),t.isEqual(u[e],i)?delete c[e]:c[e]=i,r?delete h[e]:h[e]=i}),!o){a.length&&(this._pending=s);for(var d=0;d<a.length;d++)this.trigger("change:"+a[d],this,h[a[d]],s)}if(p)return this;if(!o)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},getState:function(t){return this.state[t]},bindStateEvents:function(){var t=i.bindEvents||i.bindEntityEvents;this.stateEvents&&t(this,this,this.stateEvents)},unbindStateEvents:function(){var t=i.unbindEvents||i.unbindEntityEvents;this.stateEvents&&t(this,this,this.stateEvents)},computeStateProps:function(t,i){if(!this.finalMapStateToProps)return this.configureFinalMapState(t,i);var e=t.getState(),s=this.doStatePropsDependOnOwnProps?this.finalMapStateToProps(e,i):this.finalMapStateToProps(e);return s},configureFinalMapState:function(i,e){var s=this.mapState(i.getState(),e),n=t.isFunction(s);return this.finalMapStateToProps=n?s:this.mapState,this.doStatePropsDependOnOwnProps=1!==this.finalMapStateToProps.length,n?this.computeStateProps(i,e):s},updateStatePropsIfNeeded:function(){var i=this.computeStateProps(this.store,this.props);return(!this.stateProps||!t.isEqual(i,this.stateProps))&&(this.stateProps=i,!0)},computeDispatchProps:function(t,i){if(!this.finalMapDispatchToProps)return this.configureFinalMapDispatch(t,i);var e=t.dispatch,s=this.doDispatchPropsDependOnOwnProps?this.finalMapDispatchToProps(e,i):this.finalMapDispatchToProps(e);return s},configureFinalMapDispatch:function(i,e){var s=this.mapDispatch(i.dispatch,e),n=t.isFunction(s);return this.finalMapDispatchToProps=n?s:this.mapDispatch,this.doDispatchPropsDependOnOwnProps=1!==this.finalMapDispatchToProps.length,n?this.computeDispatchProps(i,e):s},updateDispatchPropsIfNeeded:function(){var i=this.computeDispatchProps(this.store,this.props);return(!this.dispatchProps||!t.isEqual(i,this.dispatchProps))&&(this.dispatchProps=i,!0)},isSubscribed:function(){return t.isFunction(this.unsubscribe)},trySubscribe:function(){this.isSubscribed()||(this.unsubscribe=this.store.subscribe(this.handleChange.bind(this)),this.handleDispatchProps(),this.handleChange())},tryUnsubscribe:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},onRender:function(){this.trySubscribe()},onDestroy:function(){this.tryUnsubscribe(),this.unbindStateEvents(),this.clearCache()},clearCache:function(){this.dispatchProps=null,this.stateProps=null,this.finalMapDispatchToProps=null,this.finalMapStateToProps=null,this.haveInitialStatePropsBeenDetermined=!1,this.haveInitialDispatchPropsBeenDetermined=!1},handleDispatchProps:function(){this.haveInitialDispatchPropsBeenDetermined||(this.updateDispatchPropsIfNeeded(),this.haveInitialDispatchPropsBeenDetermined=!0)},handleChange:function(){if(this.unsubscribe){var i=this.store.getState(),e=this.getState("storeState");if(!this.haveInitialStatePropsBeenDetermined||!t.isEqual(e,i)){var s=this.updateStatePropsIfNeeded();if(this.haveInitialStatePropsBeenDetermined=!0,s){var n=this.mergeProps(this.stateProps,this.dispatchProps,this.props);this.props=n,t.isFunction(this.componentDidReceiveProps)&&this.componentDidReceiveProps(n)}this.setState({storeState:i})}}}},p="0.1.7",h={connect:o,mixin:a,VERSION:p};return h});
//# sourceMappingURL=marionette-redux.min.js.map
