// Marionette Redux
// ----------------------------------
// v0.1.7
//
// Copyright (c)2016 Andrew Henderson.
// Distributed under MIT license
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("marionette")):"function"==typeof define&&define.amd?define(["underscore","marionette"],e):t.MarionetteRedux=e(t._,t.Marionette)}(this,function(t,e){"use strict";function i(){return{}}function s(t){return{dispatch:t}}function n(e,i,s){return t.extend({},s,e,i)}function o(t){return"object"===("undefined"==typeof t?"undefined":a(t))?t instanceof e.View||t instanceof e.Behavior:"function"==typeof t&&(t.prototype instanceof e.View||t.prototype instanceof e.Behavior)}function r(e,r,a,p){var u=p||{};return function(p){var c=e||p.prototype.mapStateToProps||i,f=r||p.prototype.mapDispatchToProps||s,d=a||p.prototype.mergeProps||n,l=u.store||p.prototype.store,P=p.prototype.initialize,S=p.prototype.onRender,y=p.prototype.onDestroy,m=t.defaults({},{initialize:function(t){var e=t||{};h.initialize.call(this,{mapStateToProps:c,mapDispatchToProps:f,mergeProps:d,store:l,props:e.props}),P&&P.apply(this,arguments)},onRender:function(){h.onRender.apply(this,arguments),S&&S.apply(this,arguments)},onDestroy:function(){h.onDestroy.apply(this,arguments),y&&y.apply(this,arguments)}},h);return o(p)||(m=t.omit(m,"onRender")),p.extend(m)}}t="default"in t?t.default:t,e="default"in e?e.default:e;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h={initialize:function(e){var r=e||{};this.mapState=r.mapStateToProps||this.mapStateToProps||i,this.mapDispatch=r.mapDispatchToProps||this.mapDispatchToProps||s,this.mergeProps=r.mergeProps||this.mergeProps||n,this.props=this.props||{},r.props&&t.extend(this.props,r.props),this.store=r.store||this.store,!this.store&&window&&window.store&&(this.store=window.store);var a=this.store.getState();this.state=t.defaults({storeState:a},this.getInitialState()),this.bindStateEvents(),this.clearCache(),o(this)||this.trySubscribe()},getInitialState:function(){return{}},setState:function(e,i,s){if(null==e)return this;var n=void 0;"object"===("undefined"==typeof e?"undefined":p(e))?(n=e,s=i):(n={})[e]=i,s||(s={});var o=s.unset,r=s.silent,a=[],h=this._changing;this._changing=!0,h||(this._previousState=t.clone(this.state),this.changed={});var u=this.state,c=this.changed,f=this._previousState;if(t.each(n,function(e,i){t.isEqual(u[i],e)||a.push(i),t.isEqual(f[i],e)?delete c[i]:c[i]=e,o?delete u[i]:u[i]=e}),!r){a.length&&(this._pending=s);for(var d=0;d<a.length;d++)this.trigger("change:"+a[d],this,u[a[d]],s)}if(h)return this;if(!r)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},getState:function(t){return this.state[t]},bindStateEvents:function(){var t=void 0;this.stateEvents&&(t=e.bindEvents||e.bindEntityEvents)(this,this,this.stateEvents)},unbindStateEvents:function(){var t=void 0;this.stateEvents&&(t=e.unbindEvents||e.unbindEntityEvents)(this,this,this.stateEvents)},computeStateProps:function(t,e){if(!this.finalMapStateToProps)return this.configureFinalMapState(t,e);var i=t.getState(),s=this.doStatePropsDependOnOwnProps?this.finalMapStateToProps(i,e):this.finalMapStateToProps(i);return s},configureFinalMapState:function(e,i){var s=this.mapState(e.getState(),i),n=t.isFunction(s);return this.finalMapStateToProps=n?s:this.mapState,this.doStatePropsDependOnOwnProps=1!==this.finalMapStateToProps.length,n?this.computeStateProps(e,i):s},updateStatePropsIfNeeded:function(){var e=this.computeStateProps(this.store,this.props);return(!this.stateProps||!t.isEqual(e,this.stateProps))&&(this.stateProps=e,!0)},computeDispatchProps:function(t,e){if(!this.finalMapDispatchToProps)return this.configureFinalMapDispatch(t,e);var i=t.dispatch,s=this.doDispatchPropsDependOnOwnProps?this.finalMapDispatchToProps(i,e):this.finalMapDispatchToProps(i);return s},configureFinalMapDispatch:function(e,i){var s=this.mapDispatch(e.dispatch,i),n=t.isFunction(s);return this.finalMapDispatchToProps=n?s:this.mapDispatch,this.doDispatchPropsDependOnOwnProps=1!==this.finalMapDispatchToProps.length,n?this.computeDispatchProps(e,i):s},updateDispatchPropsIfNeeded:function(){var e=this.computeDispatchProps(this.store,this.props);return(!this.dispatchProps||!t.isEqual(e,this.dispatchProps))&&(this.dispatchProps=e,!0)},isSubscribed:function(){return t.isFunction(this.unsubscribe)},trySubscribe:function(){this.isSubscribed()||(this.unsubscribe=this.store.subscribe(this.handleChange.bind(this)),this.handleDispatchProps(),this.handleChange())},tryUnsubscribe:function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},onRender:function(){this.trySubscribe()},onDestroy:function(){this.tryUnsubscribe(),this.unbindStateEvents(),this.clearCache()},clearCache:function(){this.dispatchProps=null,this.stateProps=null,this.finalMapDispatchToProps=null,this.finalMapStateToProps=null,this.haveInitialStatePropsBeenDetermined=!1,this.haveInitialDispatchPropsBeenDetermined=!1},handleDispatchProps:function(){this.haveInitialDispatchPropsBeenDetermined||(this.updateDispatchPropsIfNeeded(),this.haveInitialDispatchPropsBeenDetermined=!0)},handleChange:function(){if(this.unsubscribe){var e=this.store.getState(),i=this.getState("storeState");if(!this.haveInitialStatePropsBeenDetermined||!t.isEqual(i,e)){var s=this.updateStatePropsIfNeeded();if(this.haveInitialStatePropsBeenDetermined=!0,s){var n=this.mergeProps(this.stateProps,this.dispatchProps,this.props);this.props=n,t.isFunction(this.componentDidReceiveProps)&&this.componentDidReceiveProps(n)}this.setState({storeState:e})}}}},u="0.1.7",c={connect:r,mixin:h,VERSION:u};return c});
//# sourceMappingURL=marionette-redux.min.js.map
