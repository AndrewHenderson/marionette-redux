// Marionette Redux
// ----------------------------------
// v0.3.1
//
// Copyright (c)2017 Andrew Henderson.
// Distributed under MIT license


(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('underscore'), require('marionette')) :
	typeof define === 'function' && define.amd ? define(['underscore', 'marionette'], factory) :
	(global.MarionetteRedux = factory(global._,global.Marionette));
}(this, (function (underscore,marionette) { 'use strict';

function mapStateToProps() {
  return {};
}

function mapDispatchToProps(dispatch) {
  return {
    dispatch: dispatch
  };
}

function mergeProps(stateProps, dispatchProps, parentProps) {
  return underscore.extend({}, parentProps, stateProps, dispatchProps);
}

function isDisplayComponent(Component) {
  if (underscore.isFunction(Component)) {
    return Component.prototype instanceof marionette.View || Component.prototype instanceof marionette.Behavior;
  }
  if (underscore.isObject(Component)) {
    return Component instanceof marionette.View || Component instanceof marionette.Behavior;
  }
  return false;
}

var mixin = {
  initialize: function initialize(_options) {

    var options = _options || {};

    this.mapState = options.mapStateToProps || this.mapStateToProps || mapStateToProps;
    this.mapDispatch = options.mapDispatchToProps || this.mapDispatchToProps || mapDispatchToProps;
    this.mergeProps = options.mergeProps || this.mergeProps || mergeProps;
    this.props = this.props || {};

    if (options.props) {
      underscore.extend(this.props, options.props);
    }

    this.store = options.store || this.store;

    if (!this.store && window && window.store) {
      this.store = window.store;
    }

    var storeState = this.store.getState();
    this.state = underscore.defaults({
      storeState: storeState
    }, this.getInitialState());

    this.bindStateEvents();
    this.clearCache();

    if (!isDisplayComponent(this)) {
      this.trySubscribe();
    }
  },
  getInitialState: function getInitialState() {
    return {};
  },
  setState: function setState(key, val, options) {

    if (key == null) {
      return this;
    }

    // Handle both `"key", value` and `{key: value}` -style arguments.
    var state = void 0;
    if (underscore.isObject(key)) {
      state = key;
      options = val;
    } else {
      (state = {})[key] = val;
    }

    options || (options = {});

    // Extract state and options.
    var unset = options.unset;
    var silent = options.silent;
    var changes = [];
    var changing = this._changing;
    this._changing = true;

    if (!changing) {
      this._previousState = underscore.clone(this.state);
      this.changed = {};
    }

    var current = this.state;
    var changed = this.changed;
    var prev = this._previousState;

    // For each `set` state, update or delete the current value.
    underscore.each(state, function (_val, _key) {
      if (!underscore.isEqual(current[_key], _val)) {
        changes.push(_key);
      }
      if (!underscore.isEqual(prev[_key], _val)) {
        changed[_key] = _val;
      } else {
        delete changed[_key];
      }
      unset ? delete current[_key] : current[_key] = _val;
    });

    // Trigger all relevant state changes.
    if (!silent) {
      if (changes.length) {
        this._pending = options;
      }
      for (var i = 0; i < changes.length; i++) {
        this.trigger('change:' + changes[i], this, current[changes[i]], options);
      }
    }

    // You might be wondering why there's a `while` loop here. Changes can
    // be recursively nested within `"change"` events.
    if (changing) {
      return this;
    }
    if (!silent) {
      while (this._pending) {
        options = this._pending;
        this._pending = false;
        this.trigger('change', this, options);
        if (isDisplayComponent(this) && this.triggerDomRefresh !== false) {
          this.triggerMethod('dom:refresh');
        }
      }
    }
    this._pending = false;
    this._changing = false;
    return this;
  },
  getState: function getState(attr) {
    return this.state[attr];
  },
  bindStateEvents: function bindStateEvents() {
    var bind = marionette.bindEvents || marionette.bindEntityEvents;
    if (this.stateEvents) {
      bind(this, this, this.stateEvents);
    }
  },
  unbindStateEvents: function unbindStateEvents() {
    var unbind = marionette.unbindEvents || marionette.unbindEntityEvents;
    if (this.stateEvents) {
      unbind(this, this, this.stateEvents);
    }
  },
  computeStateProps: function computeStateProps(store, props) {
    if (!this.finalMapStateToProps) {
      return this.configureFinalMapState(store, props);
    }

    var state = store.getState();
    var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

    return stateProps;
  },
  configureFinalMapState: function configureFinalMapState(store, props) {
    var mappedState = this.mapState(store.getState(), props);
    var isFactory = underscore.isFunction(mappedState);

    this.finalMapStateToProps = isFactory ? mappedState : this.mapState;
    this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

    if (isFactory) {
      return this.computeStateProps(store, props);
    }

    return mappedState;
  },
  updateStatePropsIfNeeded: function updateStatePropsIfNeeded() {
    var nextStateProps = this.computeStateProps(this.store, this.props);
    if (this.stateProps && underscore.isEqual(nextStateProps, this.stateProps)) {
      return false;
    }

    this.stateProps = nextStateProps;

    return true;
  },
  computeDispatchProps: function computeDispatchProps(store, props) {
    if (!this.finalMapDispatchToProps) {
      return this.configureFinalMapDispatch(store, props);
    }

    var dispatch = store.dispatch;
    var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

    return dispatchProps;
  },
  configureFinalMapDispatch: function configureFinalMapDispatch(store, props) {
    var mappedDispatch = this.mapDispatch(store.dispatch, props);
    var isFactory = underscore.isFunction(mappedDispatch);

    this.finalMapDispatchToProps = isFactory ? mappedDispatch : this.mapDispatch;
    this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

    if (isFactory) {
      return this.computeDispatchProps(store, props);
    }

    return mappedDispatch;
  },
  updateDispatchPropsIfNeeded: function updateDispatchPropsIfNeeded() {
    var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
    if (this.dispatchProps && underscore.isEqual(nextDispatchProps, this.dispatchProps)) {
      return false;
    }

    this.dispatchProps = nextDispatchProps;

    return true;
  },
  isSubscribed: function isSubscribed() {
    return underscore.isFunction(this.unsubscribe);
  },
  trySubscribe: function trySubscribe() {
    if (!this.isSubscribed()) {
      this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
      this.handleDispatchProps();
      this.handleChange();
    }
  },
  tryUnsubscribe: function tryUnsubscribe() {
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
  },
  onRender: function onRender() {
    this.trySubscribe();
  },
  onDestroy: function onDestroy() {
    this.tryUnsubscribe();
    this.unbindStateEvents();
    this.clearCache();
  },
  clearCache: function clearCache() {
    this.dispatchProps = null;
    this.stateProps = null;
    this.finalMapDispatchToProps = null;
    this.finalMapStateToProps = null;
    this.haveInitialStatePropsBeenDetermined = false;
    this.haveInitialDispatchPropsBeenDetermined = false;
  },
  handleDispatchProps: function handleDispatchProps() {
    if (!this.haveInitialDispatchPropsBeenDetermined) {
      this.updateDispatchPropsIfNeeded();
      this.haveInitialDispatchPropsBeenDetermined = true;
    }
  },
  handleChange: function handleChange() {
    if (!this.unsubscribe) {
      return;
    }

    var storeState = this.store.getState();
    var prevStoreState = this.getState('storeState');
    if (this.haveInitialStatePropsBeenDetermined && underscore.isEqual(prevStoreState, storeState)) {
      return;
    }

    var haveStatePropsChanged = this.updateStatePropsIfNeeded();
    this.haveInitialStatePropsBeenDetermined = true;

    if (haveStatePropsChanged) {

      var mergedProps = this.mergeProps(this.stateProps, this.dispatchProps, this.props);
      this.props = mergedProps;

      underscore.isFunction(this.componentWillReceiveProps) && this.componentWillReceiveProps(mergedProps);

      if (isDisplayComponent(this) && this._isRendered && this.triggerDomRefresh !== false) {
        this.triggerMethod('dom:refresh');
      }
    }

    this.setState({
      storeState: storeState
    }, { silent: true });
  }
};

function connect(_mapStateToProps, _mapDispatchToProps, _mergeProps, _options) {

  var options = _options || {};

  return function (Component) {

    var mapStateToProps$$1 = _mapStateToProps || Component.prototype.mapStateToProps || mapStateToProps;
    var mapDispatchToProps$$1 = _mapDispatchToProps || Component.prototype.mapDispatchToProps || mapDispatchToProps;
    var mergeProps$$1 = _mergeProps || Component.prototype.mergeProps || mergeProps;
    var store = options.store || Component.prototype.store;
    var componentInitialize = Component.prototype.initialize;
    var componentOnRender = Component.prototype.onRender;
    var componentOnDestroy = Component.prototype.onDestroy;

    var connectMixin = underscore.defaults({}, {
      initialize: function initialize(_initOptions) {

        var initOptions = _initOptions || {};

        mixin.initialize.call(this, {
          mapStateToProps: mapStateToProps$$1,
          mapDispatchToProps: mapDispatchToProps$$1,
          mergeProps: mergeProps$$1,
          store: store,
          props: initOptions.props
        });

        if (componentInitialize) {
          componentInitialize.apply(this, arguments);
        }
      },
      onRender: function onRender() {

        mixin.onRender.apply(this, arguments);

        if (componentOnRender) {
          componentOnRender.apply(this, arguments);
        }
      },
      onDestroy: function onDestroy() {

        mixin.onDestroy.apply(this, arguments);

        if (componentOnDestroy) {
          componentOnDestroy.apply(this, arguments);
        }
      }
    }, mixin);

    if (!isDisplayComponent(Component)) {
      connectMixin = underscore.omit(connectMixin, 'onRender');
    }

    return Component.extend(connectMixin);
  };
}

var version = "0.3.1";

var MarionetteRedux = {
  connect: connect,
  mixin: mixin,
  VERSION: version
};

return MarionetteRedux;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWFwU3RhdGVUb1Byb3BzLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9tYXBEaXNwYXRjaFRvUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21lcmdlUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2lzRGlzcGxheUNvbXBvbmVudC5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWl4aW4uanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2Nvbm5lY3QuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21hcmlvbmV0dGUtcmVkdXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKCkge1xuICByZXR1cm4ge31cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCkge1xuICByZXR1cm4ge1xuICAgIGRpc3BhdGNoOiBkaXNwYXRjaFxuICB9XG59XG4iLCJpbXBvcnQgeyBleHRlbmQgfSBmcm9tICd1bmRlcnNjb3JlJztcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1lcmdlUHJvcHMoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgcGFyZW50UHJvcHMpIHtcbiAgcmV0dXJuIGV4dGVuZCh7fSwgcGFyZW50UHJvcHMsIHN0YXRlUHJvcHMsIGRpc3BhdGNoUHJvcHMpXG59XG4iLCJpbXBvcnQgeyBpc09iamVjdCwgaXNGdW5jdGlvbiB9IGZyb20gJ3VuZGVyc2NvcmUnXG5pbXBvcnQgeyBWaWV3LCBCZWhhdmlvciB9IGZyb20gJ21hcmlvbmV0dGUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzRGlzcGxheUNvbXBvbmVudChDb21wb25lbnQpIHtcbiAgaWYgKGlzRnVuY3Rpb24oQ29tcG9uZW50KSkge1xuICAgIHJldHVybiBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgVmlldyB8fCBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgQmVoYXZpb3JcbiAgfVxuICBpZiAoaXNPYmplY3QoQ29tcG9uZW50KSkge1xuICAgIHJldHVybiBDb21wb25lbnQgaW5zdGFuY2VvZiBWaWV3IHx8IENvbXBvbmVudCBpbnN0YW5jZW9mIEJlaGF2aW9yXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG4iLCJpbXBvcnQge1xuICBleHRlbmQsXG4gIGRlZmF1bHRzLFxuICBjbG9uZSxcbiAgZWFjaCxcbiAgaXNFcXVhbCxcbiAgaXNGdW5jdGlvbixcbiAgaXNPYmplY3Rcbn0gZnJvbSAndW5kZXJzY29yZSc7XG5pbXBvcnQge1xuICBiaW5kRXZlbnRzLFxuICBiaW5kRW50aXR5RXZlbnRzLFxuICB1bmJpbmRFdmVudHMsXG4gIHVuYmluZEVudGl0eUV2ZW50c1xufSBmcm9tICdtYXJpb25ldHRlJztcbmltcG9ydCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzIGZyb20gJy4vbWFwU3RhdGVUb1Byb3BzJztcbmltcG9ydCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIGZyb20gJy4vbWFwRGlzcGF0Y2hUb1Byb3BzJztcbmltcG9ydCBkZWZhdWx0TWVyZ2VQcm9wcyBmcm9tICcuL21lcmdlUHJvcHMnO1xuaW1wb3J0IGlzRGlzcGxheUNvbXBvbmVudCBmcm9tICcuL2lzRGlzcGxheUNvbXBvbmVudCc7XG5cbmNvbnN0IG1peGluID0ge1xuXG4gIGluaXRpYWxpemUoX29wdGlvbnMpIHtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBfb3B0aW9ucyB8fCB7fTtcblxuICAgIHRoaXMubWFwU3RhdGUgPSBvcHRpb25zLm1hcFN0YXRlVG9Qcm9wcyB8fCB0aGlzLm1hcFN0YXRlVG9Qcm9wcyB8fCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzO1xuICAgIHRoaXMubWFwRGlzcGF0Y2ggPSBvcHRpb25zLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCB0aGlzLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzO1xuICAgIHRoaXMubWVyZ2VQcm9wcyA9IG9wdGlvbnMubWVyZ2VQcm9wcyB8fCB0aGlzLm1lcmdlUHJvcHMgfHwgZGVmYXVsdE1lcmdlUHJvcHM7XG4gICAgdGhpcy5wcm9wcyA9IHRoaXMucHJvcHMgfHwge307XG5cbiAgICBpZiAob3B0aW9ucy5wcm9wcykge1xuICAgICAgZXh0ZW5kKHRoaXMucHJvcHMsIG9wdGlvbnMucHJvcHMpXG4gICAgfVxuXG4gICAgdGhpcy5zdG9yZSA9IG9wdGlvbnMuc3RvcmUgfHwgdGhpcy5zdG9yZTtcblxuICAgIGlmICghdGhpcy5zdG9yZSAmJiB3aW5kb3cgJiYgd2luZG93LnN0b3JlKSB7XG4gICAgICB0aGlzLnN0b3JlID0gd2luZG93LnN0b3JlXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICB0aGlzLnN0YXRlID0gZGVmYXVsdHMoe1xuICAgICAgc3RvcmVTdGF0ZTogc3RvcmVTdGF0ZVxuICAgIH0sIHRoaXMuZ2V0SW5pdGlhbFN0YXRlKCkpO1xuXG4gICAgdGhpcy5iaW5kU3RhdGVFdmVudHMoKTtcbiAgICB0aGlzLmNsZWFyQ2FjaGUoKTtcblxuICAgIGlmICghaXNEaXNwbGF5Q29tcG9uZW50KHRoaXMpKSB7XG4gICAgICB0aGlzLnRyeVN1YnNjcmliZSgpXG4gICAgfVxuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICByZXR1cm4ge31cbiAgfSxcblxuICBzZXRTdGF0ZShrZXksIHZhbCwgb3B0aW9ucykge1xuXG4gICAgaWYgKGtleSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgYm90aCBgXCJrZXlcIiwgdmFsdWVgIGFuZCBge2tleTogdmFsdWV9YCAtc3R5bGUgYXJndW1lbnRzLlxuICAgIGxldCBzdGF0ZTtcbiAgICBpZiAoaXNPYmplY3Qoa2V5KSkge1xuICAgICAgc3RhdGUgPSBrZXk7XG4gICAgICBvcHRpb25zID0gdmFsO1xuICAgIH0gZWxzZSB7XG4gICAgICAoc3RhdGUgPSB7fSlba2V5XSA9IHZhbDtcbiAgICB9XG5cbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gICAgLy8gRXh0cmFjdCBzdGF0ZSBhbmQgb3B0aW9ucy5cbiAgICBjb25zdCB1bnNldCAgICAgID0gb3B0aW9ucy51bnNldDtcbiAgICBjb25zdCBzaWxlbnQgICAgID0gb3B0aW9ucy5zaWxlbnQ7XG4gICAgY29uc3QgY2hhbmdlcyAgICA9IFtdO1xuICAgIGNvbnN0IGNoYW5naW5nICAgPSB0aGlzLl9jaGFuZ2luZztcbiAgICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7XG5cbiAgICBpZiAoIWNoYW5naW5nKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c1N0YXRlID0gY2xvbmUodGhpcy5zdGF0ZSk7XG4gICAgICB0aGlzLmNoYW5nZWQgPSB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBjaGFuZ2VkID0gdGhpcy5jaGFuZ2VkO1xuICAgIGNvbnN0IHByZXYgICAgPSB0aGlzLl9wcmV2aW91c1N0YXRlO1xuXG4gICAgLy8gRm9yIGVhY2ggYHNldGAgc3RhdGUsIHVwZGF0ZSBvciBkZWxldGUgdGhlIGN1cnJlbnQgdmFsdWUuXG4gICAgZWFjaChzdGF0ZSwgZnVuY3Rpb24oX3ZhbCwgX2tleSkge1xuICAgICAgaWYgKCFpc0VxdWFsKGN1cnJlbnRbX2tleV0sIF92YWwpKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaChfa2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICghaXNFcXVhbChwcmV2W19rZXldLCBfdmFsKSkge1xuICAgICAgICBjaGFuZ2VkW19rZXldID0gX3ZhbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBjaGFuZ2VkW19rZXldO1xuICAgICAgfVxuICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFtfa2V5XSA6IGN1cnJlbnRbX2tleV0gPSBfdmFsO1xuICAgIH0pO1xuXG4gICAgLy8gVHJpZ2dlciBhbGwgcmVsZXZhbnQgc3RhdGUgY2hhbmdlcy5cbiAgICBpZiAoIXNpbGVudCkge1xuICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuX3BlbmRpbmcgPSBvcHRpb25zO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlOicgKyBjaGFuZ2VzW2ldLCB0aGlzLCBjdXJyZW50W2NoYW5nZXNbaV1dLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBZb3UgbWlnaHQgYmUgd29uZGVyaW5nIHdoeSB0aGVyZSdzIGEgYHdoaWxlYCBsb29wIGhlcmUuIENoYW5nZXMgY2FuXG4gICAgLy8gYmUgcmVjdXJzaXZlbHkgbmVzdGVkIHdpdGhpbiBgXCJjaGFuZ2VcImAgZXZlbnRzLlxuICAgIGlmIChjaGFuZ2luZykge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGlmICghc2lsZW50KSB7XG4gICAgICB3aGlsZSAodGhpcy5fcGVuZGluZykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZztcbiAgICAgICAgdGhpcy5fcGVuZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoaXNEaXNwbGF5Q29tcG9uZW50KHRoaXMpICYmIHRoaXMudHJpZ2dlckRvbVJlZnJlc2ggIT09IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCdkb206cmVmcmVzaCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlO1xuICAgIHJldHVybiB0aGlzXG4gIH0sXG5cbiAgZ2V0U3RhdGUoYXR0cikge1xuICAgIHJldHVybiB0aGlzLnN0YXRlW2F0dHJdXG4gIH0sXG5cbiAgYmluZFN0YXRlRXZlbnRzKCkge1xuICAgIGNvbnN0IGJpbmQgPSBiaW5kRXZlbnRzIHx8IGJpbmRFbnRpdHlFdmVudHM7XG4gICAgaWYgKHRoaXMuc3RhdGVFdmVudHMpIHtcbiAgICAgIGJpbmQodGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgdW5iaW5kU3RhdGVFdmVudHMoKSB7XG4gICAgY29uc3QgdW5iaW5kID0gdW5iaW5kRXZlbnRzIHx8IHVuYmluZEVudGl0eUV2ZW50cztcbiAgICBpZiAodGhpcy5zdGF0ZUV2ZW50cykge1xuICAgICAgdW5iaW5kKHRoaXMsIHRoaXMsIHRoaXMuc3RhdGVFdmVudHMpXG4gICAgfVxuICB9LFxuXG4gIGNvbXB1dGVTdGF0ZVByb3BzKHN0b3JlLCBwcm9wcykge1xuICAgIGlmICghdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcykge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlndXJlRmluYWxNYXBTdGF0ZShzdG9yZSwgcHJvcHMpXG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuICAgIGNvbnN0IHN0YXRlUHJvcHMgPSB0aGlzLmRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMgP1xuICAgICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSwgcHJvcHMpIDpcbiAgICAgIHRoaXMuZmluYWxNYXBTdGF0ZVRvUHJvcHMoc3RhdGUpO1xuXG4gICAgcmV0dXJuIHN0YXRlUHJvcHNcbiAgfSxcblxuICBjb25maWd1cmVGaW5hbE1hcFN0YXRlKHN0b3JlLCBwcm9wcykge1xuICAgIGNvbnN0IG1hcHBlZFN0YXRlID0gdGhpcy5tYXBTdGF0ZShzdG9yZS5nZXRTdGF0ZSgpLCBwcm9wcyk7XG4gICAgY29uc3QgaXNGYWN0b3J5ID0gaXNGdW5jdGlvbihtYXBwZWRTdGF0ZSk7XG5cbiAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzID0gaXNGYWN0b3J5ID8gbWFwcGVkU3RhdGUgOiB0aGlzLm1hcFN0YXRlO1xuICAgIHRoaXMuZG9TdGF0ZVByb3BzRGVwZW5kT25Pd25Qcm9wcyA9IHRoaXMuZmluYWxNYXBTdGF0ZVRvUHJvcHMubGVuZ3RoICE9PSAxO1xuXG4gICAgaWYgKGlzRmFjdG9yeSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZVN0YXRlUHJvcHMoc3RvcmUsIHByb3BzKVxuICAgIH1cblxuICAgIHJldHVybiBtYXBwZWRTdGF0ZVxuICB9LFxuXG4gIHVwZGF0ZVN0YXRlUHJvcHNJZk5lZWRlZCgpIHtcbiAgICBjb25zdCBuZXh0U3RhdGVQcm9wcyA9IHRoaXMuY29tcHV0ZVN0YXRlUHJvcHModGhpcy5zdG9yZSwgdGhpcy5wcm9wcyk7XG4gICAgaWYgKHRoaXMuc3RhdGVQcm9wcyAmJiBpc0VxdWFsKG5leHRTdGF0ZVByb3BzLCB0aGlzLnN0YXRlUHJvcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlUHJvcHMgPSBuZXh0U3RhdGVQcm9wcztcblxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaCA9IHN0b3JlLmRpc3BhdGNoO1xuICAgIGNvbnN0IGRpc3BhdGNoUHJvcHMgPSB0aGlzLmRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMgP1xuICAgICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCwgcHJvcHMpIDpcbiAgICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpO1xuXG4gICAgcmV0dXJuIGRpc3BhdGNoUHJvcHNcbiAgfSxcblxuICBjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcykge1xuICAgIGNvbnN0IG1hcHBlZERpc3BhdGNoID0gdGhpcy5tYXBEaXNwYXRjaChzdG9yZS5kaXNwYXRjaCwgcHJvcHMpO1xuICAgIGNvbnN0IGlzRmFjdG9yeSA9IGlzRnVuY3Rpb24obWFwcGVkRGlzcGF0Y2gpO1xuXG4gICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyA9IGlzRmFjdG9yeSA/IG1hcHBlZERpc3BhdGNoIDogdGhpcy5tYXBEaXNwYXRjaDtcbiAgICB0aGlzLmRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMgPSB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzLmxlbmd0aCAhPT0gMTtcblxuICAgIGlmIChpc0ZhY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVEaXNwYXRjaFByb3BzKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICByZXR1cm4gbWFwcGVkRGlzcGF0Y2hcbiAgfSxcblxuICB1cGRhdGVEaXNwYXRjaFByb3BzSWZOZWVkZWQoKSB7XG4gICAgY29uc3QgbmV4dERpc3BhdGNoUHJvcHMgPSB0aGlzLmNvbXB1dGVEaXNwYXRjaFByb3BzKHRoaXMuc3RvcmUsIHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLmRpc3BhdGNoUHJvcHMgJiYgaXNFcXVhbChuZXh0RGlzcGF0Y2hQcm9wcywgdGhpcy5kaXNwYXRjaFByb3BzKSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgdGhpcy5kaXNwYXRjaFByb3BzID0gbmV4dERpc3BhdGNoUHJvcHM7XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9LFxuXG4gIGlzU3Vic2NyaWJlZCgpIHtcbiAgICByZXR1cm4gaXNGdW5jdGlvbih0aGlzLnVuc3Vic2NyaWJlKVxuICB9LFxuXG4gIHRyeVN1YnNjcmliZSgpIHtcbiAgICBpZiAoIXRoaXMuaXNTdWJzY3JpYmVkKCkpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSB0aGlzLnN0b3JlLnN1YnNjcmliZSh0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuaGFuZGxlRGlzcGF0Y2hQcm9wcygpO1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoKVxuICAgIH1cbiAgfSxcblxuICB0cnlVbnN1YnNjcmliZSgpIHtcbiAgICBpZiAodGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgb25SZW5kZXIoKSB7XG4gICAgdGhpcy50cnlTdWJzY3JpYmUoKVxuICB9LFxuXG4gIG9uRGVzdHJveSgpIHtcbiAgICB0aGlzLnRyeVVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy51bmJpbmRTdGF0ZUV2ZW50cygpO1xuICAgIHRoaXMuY2xlYXJDYWNoZSgpXG4gIH0sXG5cbiAgY2xlYXJDYWNoZSgpIHtcbiAgICB0aGlzLmRpc3BhdGNoUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuc3RhdGVQcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IGZhbHNlO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxEaXNwYXRjaFByb3BzQmVlbkRldGVybWluZWQgPSBmYWxzZVxuICB9LFxuXG4gIGhhbmRsZURpc3BhdGNoUHJvcHMoKSB7XG4gICAgaWYgKCF0aGlzLmhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkKSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5oYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IHRydWVcbiAgICB9XG4gIH0sXG5cbiAgaGFuZGxlQ2hhbmdlKCkge1xuICAgIGlmICghdGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBjb25zdCBwcmV2U3RvcmVTdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoJ3N0b3JlU3RhdGUnKTtcbiAgICBpZiAodGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCAmJiBpc0VxdWFsKHByZXZTdG9yZVN0YXRlLCBzdG9yZVN0YXRlKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkID0gdGhpcy51cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQoKTtcbiAgICB0aGlzLmhhdmVJbml0aWFsU3RhdGVQcm9wc0JlZW5EZXRlcm1pbmVkID0gdHJ1ZTtcblxuICAgIGlmIChoYXZlU3RhdGVQcm9wc0NoYW5nZWQpIHtcblxuICAgICAgY29uc3QgbWVyZ2VkUHJvcHMgPSB0aGlzLm1lcmdlUHJvcHModGhpcy5zdGF0ZVByb3BzLCB0aGlzLmRpc3BhdGNoUHJvcHMsIHRoaXMucHJvcHMpO1xuICAgICAgdGhpcy5wcm9wcyA9IG1lcmdlZFByb3BzO1xuXG4gICAgICBpc0Z1bmN0aW9uKHRoaXMuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcykgJiYgdGhpcy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG1lcmdlZFByb3BzKTtcblxuICAgICAgaWYgKGlzRGlzcGxheUNvbXBvbmVudCh0aGlzKSAmJiB0aGlzLl9pc1JlbmRlcmVkICYmIHRoaXMudHJpZ2dlckRvbVJlZnJlc2ggIT09IGZhbHNlKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnZG9tOnJlZnJlc2gnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHN0b3JlU3RhdGVcbiAgICB9LCB7IHNpbGVudDogdHJ1ZSB9KVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBtaXhpbjtcbiIsImltcG9ydCB7IGRlZmF1bHRzLCBvbWl0IH0gZnJvbSAndW5kZXJzY29yZSc7XG5pbXBvcnQgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcyBmcm9tICcuL21hcFN0YXRlVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIGZyb20gJy4vbWFwRGlzcGF0Y2hUb1Byb3BzJ1xuaW1wb3J0IGRlZmF1bHRNZXJnZVByb3BzIGZyb20gJy4vbWVyZ2VQcm9wcydcbmltcG9ydCBtaXhpbiBmcm9tICcuL21peGluJ1xuaW1wb3J0IGlzRGlzcGxheUNvbXBvbmVudCBmcm9tICcuL2lzRGlzcGxheUNvbXBvbmVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNvbm5lY3QoX21hcFN0YXRlVG9Qcm9wcywgX21hcERpc3BhdGNoVG9Qcm9wcywgX21lcmdlUHJvcHMsIF9vcHRpb25zKSB7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IF9vcHRpb25zIHx8IHt9O1xuXG4gIHJldHVybiBmdW5jdGlvbihDb21wb25lbnQpIHtcblxuICAgIGNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IF9tYXBTdGF0ZVRvUHJvcHMgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5tYXBTdGF0ZVRvUHJvcHMgfHwgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcztcbiAgICBjb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSBfbWFwRGlzcGF0Y2hUb1Byb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWFwRGlzcGF0Y2hUb1Byb3BzIHx8IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHM7XG4gICAgY29uc3QgbWVyZ2VQcm9wcyA9IF9tZXJnZVByb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWVyZ2VQcm9wcyB8fCBkZWZhdWx0TWVyZ2VQcm9wcztcbiAgICBjb25zdCBzdG9yZSA9IG9wdGlvbnMuc3RvcmUgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5zdG9yZTtcbiAgICBjb25zdCBjb21wb25lbnRJbml0aWFsaXplID0gQ29tcG9uZW50LnByb3RvdHlwZS5pbml0aWFsaXplO1xuICAgIGNvbnN0IGNvbXBvbmVudE9uUmVuZGVyID0gQ29tcG9uZW50LnByb3RvdHlwZS5vblJlbmRlcjtcbiAgICBjb25zdCBjb21wb25lbnRPbkRlc3Ryb3kgPSBDb21wb25lbnQucHJvdG90eXBlLm9uRGVzdHJveTtcblxuICAgIGxldCBjb25uZWN0TWl4aW4gPSBkZWZhdWx0cyh7fSwge1xuXG4gICAgICBpbml0aWFsaXplKF9pbml0T3B0aW9ucykge1xuXG4gICAgICAgIGNvbnN0IGluaXRPcHRpb25zID0gX2luaXRPcHRpb25zIHx8IHt9O1xuXG4gICAgICAgIG1peGluLmluaXRpYWxpemUuY2FsbCh0aGlzLCB7XG4gICAgICAgICAgbWFwU3RhdGVUb1Byb3BzLFxuICAgICAgICAgIG1hcERpc3BhdGNoVG9Qcm9wcyxcbiAgICAgICAgICBtZXJnZVByb3BzLFxuICAgICAgICAgIHN0b3JlLFxuICAgICAgICAgIHByb3BzOiBpbml0T3B0aW9ucy5wcm9wc1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoY29tcG9uZW50SW5pdGlhbGl6ZSkge1xuICAgICAgICAgIGNvbXBvbmVudEluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgb25SZW5kZXIoKSB7XG5cbiAgICAgICAgbWl4aW4ub25SZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuICAgICAgICBpZiAoY29tcG9uZW50T25SZW5kZXIpIHtcbiAgICAgICAgICBjb21wb25lbnRPblJlbmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIG9uRGVzdHJveSgpIHtcblxuICAgICAgICBtaXhpbi5vbkRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuICAgICAgICBpZiAoY29tcG9uZW50T25EZXN0cm95KSB7XG4gICAgICAgICAgY29tcG9uZW50T25EZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBtaXhpbik7XG5cbiAgICBpZiAoIWlzRGlzcGxheUNvbXBvbmVudChDb21wb25lbnQpKSB7XG4gICAgICBjb25uZWN0TWl4aW4gPSBvbWl0KGNvbm5lY3RNaXhpbiwgJ29uUmVuZGVyJylcbiAgICB9XG5cbiAgICByZXR1cm4gQ29tcG9uZW50LmV4dGVuZChjb25uZWN0TWl4aW4pXG4gIH1cbn1cbiIsImltcG9ydCBjb25uZWN0IGZyb20gJy4vY29ubmVjdCdcbmltcG9ydCBtaXhpbiBmcm9tICcuL21peGluJ1xuaW1wb3J0IHsgdmVyc2lvbiBhcyBWRVJTSU9OIH0gZnJvbSAnLi4vcGFja2FnZS5qc29uJ1xuXG5jb25zdCBNYXJpb25ldHRlUmVkdXggPSB7XG4gIGNvbm5lY3QsXG4gIG1peGluLFxuICBWRVJTSU9OXG59XG5cbmV4cG9ydCBkZWZhdWx0IE1hcmlvbmV0dGVSZWR1eFxuIl0sIm5hbWVzIjpbIm1hcFN0YXRlVG9Qcm9wcyIsIm1hcERpc3BhdGNoVG9Qcm9wcyIsImRpc3BhdGNoIiwibWVyZ2VQcm9wcyIsInN0YXRlUHJvcHMiLCJkaXNwYXRjaFByb3BzIiwicGFyZW50UHJvcHMiLCJleHRlbmQiLCJpc0Rpc3BsYXlDb21wb25lbnQiLCJDb21wb25lbnQiLCJpc0Z1bmN0aW9uIiwicHJvdG90eXBlIiwiVmlldyIsIkJlaGF2aW9yIiwiaXNPYmplY3QiLCJtaXhpbiIsIl9vcHRpb25zIiwib3B0aW9ucyIsIm1hcFN0YXRlIiwiZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcyIsIm1hcERpc3BhdGNoIiwiZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcyIsImRlZmF1bHRNZXJnZVByb3BzIiwicHJvcHMiLCJzdG9yZSIsIndpbmRvdyIsInN0b3JlU3RhdGUiLCJnZXRTdGF0ZSIsInN0YXRlIiwiZGVmYXVsdHMiLCJnZXRJbml0aWFsU3RhdGUiLCJiaW5kU3RhdGVFdmVudHMiLCJjbGVhckNhY2hlIiwidHJ5U3Vic2NyaWJlIiwia2V5IiwidmFsIiwidW5zZXQiLCJzaWxlbnQiLCJjaGFuZ2VzIiwiY2hhbmdpbmciLCJfY2hhbmdpbmciLCJfcHJldmlvdXNTdGF0ZSIsImNsb25lIiwiY2hhbmdlZCIsImN1cnJlbnQiLCJwcmV2IiwiX3ZhbCIsIl9rZXkiLCJpc0VxdWFsIiwicHVzaCIsImxlbmd0aCIsIl9wZW5kaW5nIiwiaSIsInRyaWdnZXIiLCJ0cmlnZ2VyRG9tUmVmcmVzaCIsInRyaWdnZXJNZXRob2QiLCJhdHRyIiwiYmluZCIsImJpbmRFdmVudHMiLCJiaW5kRW50aXR5RXZlbnRzIiwic3RhdGVFdmVudHMiLCJ1bmJpbmQiLCJ1bmJpbmRFdmVudHMiLCJ1bmJpbmRFbnRpdHlFdmVudHMiLCJmaW5hbE1hcFN0YXRlVG9Qcm9wcyIsImNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUiLCJkb1N0YXRlUHJvcHNEZXBlbmRPbk93blByb3BzIiwibWFwcGVkU3RhdGUiLCJpc0ZhY3RvcnkiLCJjb21wdXRlU3RhdGVQcm9wcyIsIm5leHRTdGF0ZVByb3BzIiwiZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMiLCJjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoIiwiZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyIsIm1hcHBlZERpc3BhdGNoIiwiY29tcHV0ZURpc3BhdGNoUHJvcHMiLCJuZXh0RGlzcGF0Y2hQcm9wcyIsInVuc3Vic2NyaWJlIiwiaXNTdWJzY3JpYmVkIiwic3Vic2NyaWJlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlRGlzcGF0Y2hQcm9wcyIsInRyeVVuc3Vic2NyaWJlIiwidW5iaW5kU3RhdGVFdmVudHMiLCJoYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCIsImhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkIiwidXBkYXRlRGlzcGF0Y2hQcm9wc0lmTmVlZGVkIiwicHJldlN0b3JlU3RhdGUiLCJoYXZlU3RhdGVQcm9wc0NoYW5nZWQiLCJ1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQiLCJtZXJnZWRQcm9wcyIsImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJfaXNSZW5kZXJlZCIsInNldFN0YXRlIiwiY29ubmVjdCIsIl9tYXBTdGF0ZVRvUHJvcHMiLCJfbWFwRGlzcGF0Y2hUb1Byb3BzIiwiX21lcmdlUHJvcHMiLCJjb21wb25lbnRJbml0aWFsaXplIiwiaW5pdGlhbGl6ZSIsImNvbXBvbmVudE9uUmVuZGVyIiwib25SZW5kZXIiLCJjb21wb25lbnRPbkRlc3Ryb3kiLCJvbkRlc3Ryb3kiLCJjb25uZWN0TWl4aW4iLCJfaW5pdE9wdGlvbnMiLCJpbml0T3B0aW9ucyIsImNhbGwiLCJhcHBseSIsImFyZ3VtZW50cyIsIm9taXQiLCJNYXJpb25ldHRlUmVkdXgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQWUsU0FBU0EsZUFBVCxHQUEyQjtTQUNqQyxFQUFQOzs7QUNEYSxTQUFTQyxrQkFBVCxDQUE0QkMsUUFBNUIsRUFBc0M7U0FDNUM7Y0FDS0E7R0FEWjs7O0FDQWEsU0FBU0MsVUFBVCxDQUFvQkMsVUFBcEIsRUFBZ0NDLGFBQWhDLEVBQStDQyxXQUEvQyxFQUE0RDtTQUNsRUMsa0JBQU8sRUFBUCxFQUFXRCxXQUFYLEVBQXdCRixVQUF4QixFQUFvQ0MsYUFBcEMsQ0FBUDs7O0FDQ2EsU0FBU0csa0JBQVQsQ0FBNEJDLFNBQTVCLEVBQXVDO01BQ2hEQyxzQkFBV0QsU0FBWCxDQUFKLEVBQTJCO1dBQ2xCQSxVQUFV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