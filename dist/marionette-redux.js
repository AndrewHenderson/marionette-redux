// Marionette Redux
// ----------------------------------
// v1.0.0
//
// Copyright (c)2016 Andrew Henderson.
// Distributed under MIT license


(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('underscore'), require('marionette')) :
  typeof define === 'function' && define.amd ? define(['exports', 'underscore', 'marionette'], factory) :
  (factory((global.MarionetteRedux = global.MarionetteRedux || {}),global._,global.Marionette));
}(this, (function (exports,_,Marionette) { 'use strict';

_ = 'default' in _ ? _['default'] : _;
Marionette = 'default' in Marionette ? Marionette['default'] : Marionette;

var defaultMapStateToProps = (function (state) {
  return {};
});

var defaultMapDispatchToProps = (function (dispatch) {
  return { dispatch: dispatch };
});

var defaultMergeProps = (function (stateProps, dispatchProps, parentProps) {
  return _.extend({}, parentProps, stateProps, dispatchProps);
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var setState = function (key, val, options) {

  if (key == null) {
    return this;
  }

  // Handle both `"key", value` and `{key: value}` -style arguments.
  var state = void 0;
  if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
    state = key;
    options = val;
  } else {
    (state = {})[key] = val;
  }

  options || (options = {});

  // Extract state and options.
  var unset = options.unset;
  var silent = options.silent;
  var changes = [];
  var changing = this._changing;
  this._changing = true;

  if (!changing) {
    this._previousState = _.clone(this.state);
    this.changed = {};
  }

  var current = this.state;
  var changed = this.changed;
  var prev = this._previousState;

  // For each `set` state, update or delete the current value.
  _.each(state, function (_val, _key) {
    if (!_.isEqual(current[_key], _val)) {
      changes.push(_key);
    }
    if (!_.isEqual(prev[_key], _val)) {
      changed[_key] = _val;
    } else {
      delete changed[_key];
    }
    unset ? delete current[_key] : current[_key] = _val;
  });

  // Trigger all relevant state changes.
  if (!silent) {
    if (changes.length) {
      this._pending = options;
    }
    for (var i = 0; i < changes.length; i++) {
      this.trigger('change:' + changes[i], this, current[changes[i]], options);
    }
  }

  // You might be wondering why there's a `while` loop here. Changes can
  // be recursively nested within `"change"` events.
  if (changing) {
    return this;
  }
  if (!silent) {
    while (this._pending) {
      options = this._pending;
      this._pending = false;
      this.trigger('change', this, options);
    }
  }
  this._pending = false;
  this._changing = false;
  return this;
};

var getState = function (attr) {
  return this.state[attr];
};

var mixin = {
  initialize: function initialize(_options) {

    var options = _options || {};

    this.mapState = options.mapStateToProps || this.mapStateToProps || defaultMapStateToProps;
    this.mapDispatch = options.mapDispatchToProps || this.mapDispatchToProps || defaultMapDispatchToProps;
    this.props = this.props || {};
    if (options.props) {
      _.extend(this.props, options.props);
    }
    this.store = options.store || this.store;
    var storeState = this.store.getState();
    this.state = _.defaults({
      storeState: storeState
    }, this.state);
    this.bindStateEvents();
    this.clearCache();
    this.trySubscribe();
  },


  setState: setState,

  getState: getState,

  bindStateEvents: function bindStateEvents() {
    if (this.stateEvents) {
      Marionette.bindEvents(this, this, this.stateEvents);
    }
  },
  unbindStateEvents: function unbindStateEvents() {
    if (this.stateEvents) {
      Marionette.unbindEvents(this, this, this.stateEvents);
    }
  },
  computeStateProps: function computeStateProps(store, props) {
    if (!this.finalMapStateToProps) {
      return this.configureFinalMapState(store, props);
    }

    var state = store.getState();
    var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

    return stateProps;
  },
  configureFinalMapState: function configureFinalMapState(store, props) {
    var mappedState = this.mapState(store.getState(), props);
    var isFactory = _.isFunction(mappedState);

    this.finalMapStateToProps = isFactory ? mappedState : this.mapState;
    this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

    if (isFactory) {
      return this.computeStateProps(store, props);
    }

    return mappedState;
  },
  updateStatePropsIfNeeded: function updateStatePropsIfNeeded() {
    var nextStateProps = this.computeStateProps(this.store, this.props);
    if (this.stateProps && _.isEqual(nextStateProps, this.stateProps)) {
      return false;
    }

    this.stateProps = nextStateProps;

    return true;
  },
  computeDispatchProps: function computeDispatchProps(store, props) {
    if (!this.finalMapDispatchToProps) {
      return this.configureFinalMapDispatch(store, props);
    }

    var dispatch = store.dispatch;
    var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

    return dispatchProps;
  },
  configureFinalMapDispatch: function configureFinalMapDispatch(store, props) {
    var mappedDispatch = this.mapDispatch(store.dispatch, props);
    var isFactory = _.isFunction(mappedDispatch);

    this.finalMapDispatchToProps = isFactory ? mappedDispatch : this.mapDispatch;
    this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

    if (isFactory) {
      return this.computeDispatchProps(store, props);
    }

    return mappedDispatch;
  },
  updateDispatchPropsIfNeeded: function updateDispatchPropsIfNeeded() {
    var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
    if (this.dispatchProps && _.isEqual(nextDispatchProps, this.dispatchProps)) {
      return false;
    }

    this.dispatchProps = nextDispatchProps;

    return true;
  },
  isSubscribed: function isSubscribed() {
    return _.isFunction(this.unsubscribe);
  },
  trySubscribe: function trySubscribe() {
    if (!this.isSubscribed()) {
      this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
      this.handleDispatchProps();
      this.handleChange();
    }
  },
  tryUnsubscribe: function tryUnsubscribe() {
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
  },
  onDestroy: function onDestroy() {
    this.tryUnsubscribe();
    this.unbindStateEvents();
    this.clearCache();
  },
  clearCache: function clearCache() {
    this.dispatchProps = null;
    this.stateProps = null;
    this.finalMapDispatchToProps = null;
    this.finalMapStateToProps = null;
    this.haveInitialStatePropsBeenDetermined = false;
    this.haveInitialDispatchPropsBeenDetermined = false;
  },
  handleDispatchProps: function handleDispatchProps() {
    if (!this.haveInitialDispatchPropsBeenDetermined) {
      this.updateDispatchPropsIfNeeded();
      this.haveInitialDispatchPropsBeenDetermined = true;
    }
  },
  handleChange: function handleChange() {
    if (!this.unsubscribe) {
      return;
    }

    var storeState = this.store.getState();
    var prevStoreState = this.getState('storeState');
    if (this.haveInitialStatePropsBeenDetermined && _.isEqual(prevStoreState, storeState)) {
      return;
    }

    var haveStatePropsChanged = this.updateStatePropsIfNeeded();
    this.haveInitialStatePropsBeenDetermined = true;

    if (haveStatePropsChanged) {

      var mergedProps = defaultMergeProps(this.stateProps, this.dispatchProps, this.props);
      this.props = mergedProps;

      _.isFunction(this.componentDidReceiveProps) && this.componentDidReceiveProps(mergedProps);
    }

    this.setState({
      storeState: storeState
    });
  }
};

var connect = (function (_mapStateToProps, _mapDispatchToProps, _options) {

  var options = _options || {};

  return function (Component) {

    var mapStateToProps = _mapStateToProps || Component.prototype.mapStateToProps || defaultMapStateToProps;
    var mapDispatchToProps = _mapDispatchToProps || Component.prototype.mapDispatchToProps || defaultMapDispatchToProps;
    var store = options.store || Component.prototype.store;
    var componentInitialize = Component.prototype.initialize;
    var componentOnDestroy = Component.prototype.onDestroy;

    var connectMixin = _.defaults({}, {
      initialize: function initialize(_initOptions) {

        var initOptions = _initOptions || {};

        mixin.initialize.call(this, {
          mapStateToProps: mapStateToProps,
          mapDispatchToProps: mapDispatchToProps,
          store: store,
          props: initOptions.props
        });

        if (componentInitialize) {
          componentInitialize.call(this, initOptions);
        }
      },
      onDestroy: function onDestroy() {

        mixin.onDestroy.call(this);

        if (componentOnDestroy) {
          componentOnDestroy.call(this);
        }
      }
    }, mixin);

    return Component.extend(connectMixin);
  };
});

exports.connect = connect;
exports.mixin = mixin;

Object.defineProperty(exports, '__esModule', { value: true });

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWFwU3RhdGVUb1Byb3BzLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9tYXBEaXNwYXRjaFRvUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21lcmdlUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL3NldFN0YXRlLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9nZXRTdGF0ZS5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWl4aW4uanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2Nvbm5lY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgc3RhdGUgPT4gKHt9KVxuIiwiZXhwb3J0IGRlZmF1bHQgZGlzcGF0Y2ggPT4gKHsgZGlzcGF0Y2ggfSlcbiIsImltcG9ydCBfIGZyb20gJ3VuZGVyc2NvcmUnO1xuZXhwb3J0IGRlZmF1bHQgKHN0YXRlUHJvcHMsIGRpc3BhdGNoUHJvcHMsIHBhcmVudFByb3BzKSA9PiAoXG4gIF8uZXh0ZW5kKHt9LCBwYXJlbnRQcm9wcywgc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcylcbilcbiIsImltcG9ydCBfIGZyb20gJ3VuZGVyc2NvcmUnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbihrZXksIHZhbCwgb3B0aW9ucykge1xuXG4gIGlmIChrZXkgPT0gbnVsbCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLy8gSGFuZGxlIGJvdGggYFwia2V5XCIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy5cbiAgbGV0IHN0YXRlO1xuICBpZiAodHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHtcbiAgICBzdGF0ZSA9IGtleTtcbiAgICBvcHRpb25zID0gdmFsO1xuICB9IGVsc2Uge1xuICAgIChzdGF0ZSA9IHt9KVtrZXldID0gdmFsO1xuICB9XG5cbiAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTtcblxuICAvLyBFeHRyYWN0IHN0YXRlIGFuZCBvcHRpb25zLlxuICBjb25zdCB1bnNldCAgICAgID0gb3B0aW9ucy51bnNldDtcbiAgY29uc3Qgc2lsZW50ICAgICA9IG9wdGlvbnMuc2lsZW50O1xuICBjb25zdCBjaGFuZ2VzICAgID0gW107XG4gIGNvbnN0IGNoYW5naW5nICAgPSB0aGlzLl9jaGFuZ2luZztcbiAgdGhpcy5fY2hhbmdpbmcgPSB0cnVlO1xuXG4gIGlmICghY2hhbmdpbmcpIHtcbiAgICB0aGlzLl9wcmV2aW91c1N0YXRlID0gXy5jbG9uZSh0aGlzLnN0YXRlKTtcbiAgICB0aGlzLmNoYW5nZWQgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IGN1cnJlbnQgPSB0aGlzLnN0YXRlO1xuICBjb25zdCBjaGFuZ2VkID0gdGhpcy5jaGFuZ2VkO1xuICBjb25zdCBwcmV2ICAgID0gdGhpcy5fcHJldmlvdXNTdGF0ZTtcblxuICAvLyBGb3IgZWFjaCBgc2V0YCBzdGF0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS5cbiAgXy5lYWNoKHN0YXRlLCBmdW5jdGlvbihfdmFsLCBfa2V5KSB7XG4gICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudFtfa2V5XSwgX3ZhbCkpIHtcbiAgICAgIGNoYW5nZXMucHVzaChfa2V5KTtcbiAgICB9XG4gICAgaWYgKCFfLmlzRXF1YWwocHJldltfa2V5XSwgX3ZhbCkpIHtcbiAgICAgIGNoYW5nZWRbX2tleV0gPSBfdmFsO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgY2hhbmdlZFtfa2V5XTtcbiAgICB9XG4gICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFtfa2V5XSA6IGN1cnJlbnRbX2tleV0gPSBfdmFsO1xuICB9KTtcblxuICAvLyBUcmlnZ2VyIGFsbCByZWxldmFudCBzdGF0ZSBjaGFuZ2VzLlxuICBpZiAoIXNpbGVudCkge1xuICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkge1xuICAgICAgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFlvdSBtaWdodCBiZSB3b25kZXJpbmcgd2h5IHRoZXJlJ3MgYSBgd2hpbGVgIGxvb3AgaGVyZS4gQ2hhbmdlcyBjYW5cbiAgLy8gYmUgcmVjdXJzaXZlbHkgbmVzdGVkIHdpdGhpbiBgXCJjaGFuZ2VcImAgZXZlbnRzLlxuICBpZiAoY2hhbmdpbmcpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBpZiAoIXNpbGVudCkge1xuICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7XG4gICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZztcbiAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7XG4gICAgfVxuICB9XG4gIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTtcbiAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTtcbiAgcmV0dXJuIHRoaXNcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKGF0dHIpIHtcbiAgcmV0dXJuIHRoaXMuc3RhdGVbYXR0cl07XG59XG4iLCJpbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmltcG9ydCBNYXJpb25ldHRlIGZyb20gJ21hcmlvbmV0dGUnXG5pbXBvcnQgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcyBmcm9tICcuL21hcFN0YXRlVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIGZyb20gJy4vbWFwRGlzcGF0Y2hUb1Byb3BzJ1xuaW1wb3J0IGRlZmF1bHRNZXJnZVByb3BzIGZyb20gJy4vbWVyZ2VQcm9wcydcbmltcG9ydCBzZXRTdGF0ZSBmcm9tICcuL3NldFN0YXRlJ1xuaW1wb3J0IGdldFN0YXRlIGZyb20gJy4vZ2V0U3RhdGUnXG5cbmV4cG9ydCBkZWZhdWx0IHtcblxuICBpbml0aWFsaXplKF9vcHRpb25zKSB7XG5cbiAgICBjb25zdCBvcHRpb25zID0gX29wdGlvbnMgfHwge307XG5cbiAgICB0aGlzLm1hcFN0YXRlID0gb3B0aW9ucy5tYXBTdGF0ZVRvUHJvcHMgfHwgdGhpcy5tYXBTdGF0ZVRvUHJvcHMgfHwgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcztcbiAgICB0aGlzLm1hcERpc3BhdGNoID0gb3B0aW9ucy5tYXBEaXNwYXRjaFRvUHJvcHMgfHwgdGhpcy5tYXBEaXNwYXRjaFRvUHJvcHMgfHwgZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcztcbiAgICB0aGlzLnByb3BzID0gdGhpcy5wcm9wcyB8fCB7fTtcbiAgICBpZiAob3B0aW9ucy5wcm9wcykge1xuICAgICAgXy5leHRlbmQodGhpcy5wcm9wcywgb3B0aW9ucy5wcm9wcylcbiAgICB9XG4gICAgdGhpcy5zdG9yZSA9IG9wdGlvbnMuc3RvcmUgfHwgdGhpcy5zdG9yZTtcbiAgICBjb25zdCBzdG9yZVN0YXRlID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpO1xuICAgIHRoaXMuc3RhdGUgPSBfLmRlZmF1bHRzKHtcbiAgICAgIHN0b3JlU3RhdGU6IHN0b3JlU3RhdGVcbiAgICB9LCB0aGlzLnN0YXRlKTtcbiAgICB0aGlzLmJpbmRTdGF0ZUV2ZW50cygpO1xuICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICAgIHRoaXMudHJ5U3Vic2NyaWJlKClcbiAgfSxcblxuICBzZXRTdGF0ZSxcblxuICBnZXRTdGF0ZSxcblxuICBiaW5kU3RhdGVFdmVudHMoKSB7XG4gICAgaWYgKHRoaXMuc3RhdGVFdmVudHMpIHtcbiAgICAgIE1hcmlvbmV0dGUuYmluZEV2ZW50cyh0aGlzLCB0aGlzLCB0aGlzLnN0YXRlRXZlbnRzKVxuICAgIH1cbiAgfSxcblxuICB1bmJpbmRTdGF0ZUV2ZW50cygpIHtcbiAgICBpZiAodGhpcy5zdGF0ZUV2ZW50cykge1xuICAgICAgTWFyaW9uZXR0ZS51bmJpbmRFdmVudHModGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZVN0YXRlUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcFN0YXRlKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3Qgc3RhdGVQcm9wcyA9IHRoaXMuZG9TdGF0ZVByb3BzRGVwZW5kT25Pd25Qcm9wcyA/XG4gICAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKHN0YXRlLCBwcm9wcykgOlxuICAgICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSk7XG5cbiAgICByZXR1cm4gc3RhdGVQcm9wc1xuICB9LFxuXG4gIGNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUoc3RvcmUsIHByb3BzKSB7XG4gICAgY29uc3QgbWFwcGVkU3RhdGUgPSB0aGlzLm1hcFN0YXRlKHN0b3JlLmdldFN0YXRlKCksIHByb3BzKTtcbiAgICBjb25zdCBpc0ZhY3RvcnkgPSBfLmlzRnVuY3Rpb24obWFwcGVkU3RhdGUpO1xuXG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IGlzRmFjdG9yeSA/IG1hcHBlZFN0YXRlIDogdGhpcy5tYXBTdGF0ZTtcbiAgICB0aGlzLmRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMgPSB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzLmxlbmd0aCAhPT0gMTtcblxuICAgIGlmIChpc0ZhY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICByZXR1cm4gbWFwcGVkU3RhdGVcbiAgfSxcblxuICB1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQoKSB7XG4gICAgY29uc3QgbmV4dFN0YXRlUHJvcHMgPSB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHRoaXMuc3RvcmUsIHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLnN0YXRlUHJvcHMgJiYgXy5pc0VxdWFsKG5leHRTdGF0ZVByb3BzLCB0aGlzLnN0YXRlUHJvcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlUHJvcHMgPSBuZXh0U3RhdGVQcm9wcztcblxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaCA9IHN0b3JlLmRpc3BhdGNoO1xuICAgIGNvbnN0IGRpc3BhdGNoUHJvcHMgPSB0aGlzLmRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMgP1xuICAgICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCwgcHJvcHMpIDpcbiAgICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpO1xuXG4gICAgcmV0dXJuIGRpc3BhdGNoUHJvcHNcbiAgfSxcblxuICBjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcykge1xuICAgIGNvbnN0IG1hcHBlZERpc3BhdGNoID0gdGhpcy5tYXBEaXNwYXRjaChzdG9yZS5kaXNwYXRjaCwgcHJvcHMpO1xuICAgIGNvbnN0IGlzRmFjdG9yeSA9IF8uaXNGdW5jdGlvbihtYXBwZWREaXNwYXRjaCk7XG5cbiAgICB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzID0gaXNGYWN0b3J5ID8gbWFwcGVkRGlzcGF0Y2ggOiB0aGlzLm1hcERpc3BhdGNoO1xuICAgIHRoaXMuZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyA9IHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMubGVuZ3RoICE9PSAxO1xuXG4gICAgaWYgKGlzRmFjdG9yeSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKVxuICAgIH1cblxuICAgIHJldHVybiBtYXBwZWREaXNwYXRjaFxuICB9LFxuXG4gIHVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpIHtcbiAgICBjb25zdCBuZXh0RGlzcGF0Y2hQcm9wcyA9IHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHModGhpcy5zdG9yZSwgdGhpcy5wcm9wcyk7XG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hQcm9wcyAmJiBfLmlzRXF1YWwobmV4dERpc3BhdGNoUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcykpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMuZGlzcGF0Y2hQcm9wcyA9IG5leHREaXNwYXRjaFByb3BzO1xuXG4gICAgcmV0dXJuIHRydWVcbiAgfSxcblxuICBpc1N1YnNjcmliZWQoKSB7XG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbih0aGlzLnVuc3Vic2NyaWJlKVxuICB9LFxuXG4gIHRyeVN1YnNjcmliZSgpIHtcbiAgICBpZiAoIXRoaXMuaXNTdWJzY3JpYmVkKCkpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSB0aGlzLnN0b3JlLnN1YnNjcmliZSh0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuaGFuZGxlRGlzcGF0Y2hQcm9wcygpO1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoKVxuICAgIH1cbiAgfSxcblxuICB0cnlVbnN1YnNjcmliZSgpIHtcbiAgICBpZiAodGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgb25EZXN0cm95KCkge1xuICAgIHRoaXMudHJ5VW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnVuYmluZFN0YXRlRXZlbnRzKCk7XG4gICAgdGhpcy5jbGVhckNhY2hlKClcbiAgfSxcblxuICBjbGVhckNhY2hlKCkge1xuICAgIHRoaXMuZGlzcGF0Y2hQcm9wcyA9IG51bGw7XG4gICAgdGhpcy5zdGF0ZVByb3BzID0gbnVsbDtcbiAgICB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzID0gbnVsbDtcbiAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzID0gbnVsbDtcbiAgICB0aGlzLmhhdmVJbml0aWFsU3RhdGVQcm9wc0JlZW5EZXRlcm1pbmVkID0gZmFsc2U7XG4gICAgdGhpcy5oYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IGZhbHNlXG4gIH0sXG5cbiAgaGFuZGxlRGlzcGF0Y2hQcm9wcygpIHtcbiAgICBpZiAoIXRoaXMuaGF2ZUluaXRpYWxEaXNwYXRjaFByb3BzQmVlbkRldGVybWluZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGF0Y2hQcm9wc0lmTmVlZGVkKCk7XG4gICAgICB0aGlzLmhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkID0gdHJ1ZVxuICAgIH1cbiAgfSxcblxuICBoYW5kbGVDaGFuZ2UoKSB7XG4gICAgaWYgKCF0aGlzLnVuc3Vic2NyaWJlKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBzdG9yZVN0YXRlID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpO1xuICAgIGNvbnN0IHByZXZTdG9yZVN0YXRlID0gdGhpcy5nZXRTdGF0ZSgnc3RvcmVTdGF0ZScpO1xuICAgIGlmICh0aGlzLmhhdmVJbml0aWFsU3RhdGVQcm9wc0JlZW5EZXRlcm1pbmVkICYmIF8uaXNFcXVhbChwcmV2U3RvcmVTdGF0ZSwgc3RvcmVTdGF0ZSkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IGhhdmVTdGF0ZVByb3BzQ2hhbmdlZCA9IHRoaXMudXBkYXRlU3RhdGVQcm9wc0lmTmVlZGVkKCk7XG4gICAgdGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IHRydWU7XG5cbiAgICBpZiAoaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkKSB7XG5cbiAgICAgIGNvbnN0IG1lcmdlZFByb3BzID0gZGVmYXVsdE1lcmdlUHJvcHModGhpcy5zdGF0ZVByb3BzLCB0aGlzLmRpc3BhdGNoUHJvcHMsIHRoaXMucHJvcHMpO1xuICAgICAgdGhpcy5wcm9wcyA9IG1lcmdlZFByb3BzO1xuXG4gICAgICBfLmlzRnVuY3Rpb24odGhpcy5jb21wb25lbnREaWRSZWNlaXZlUHJvcHMpICYmIHRoaXMuY29tcG9uZW50RGlkUmVjZWl2ZVByb3BzKG1lcmdlZFByb3BzKVxuICAgIH1cblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc3RvcmVTdGF0ZVxuICAgIH0pXG4gIH1cbn07XG4iLCJpbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmltcG9ydCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzIGZyb20gJy4vbWFwU3RhdGVUb1Byb3BzJ1xuaW1wb3J0IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHMgZnJvbSAnLi9tYXBEaXNwYXRjaFRvUHJvcHMnXG5pbXBvcnQgbWl4aW4gZnJvbSAnLi9taXhpbidcblxuZXhwb3J0IGRlZmF1bHQgKF9tYXBTdGF0ZVRvUHJvcHMsIF9tYXBEaXNwYXRjaFRvUHJvcHMsIF9vcHRpb25zKSA9PiB7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IF9vcHRpb25zIHx8IHt9O1xuXG4gIHJldHVybiBmdW5jdGlvbihDb21wb25lbnQpIHtcblxuICAgIGNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IF9tYXBTdGF0ZVRvUHJvcHMgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5tYXBTdGF0ZVRvUHJvcHMgfHwgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcztcbiAgICBjb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSBfbWFwRGlzcGF0Y2hUb1Byb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWFwRGlzcGF0Y2hUb1Byb3BzIHx8IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHM7XG4gICAgY29uc3Qgc3RvcmUgPSBvcHRpb25zLnN0b3JlIHx8IENvbXBvbmVudC5wcm90b3R5cGUuc3RvcmU7XG4gICAgY29uc3QgY29tcG9uZW50SW5pdGlhbGl6ZSA9IENvbXBvbmVudC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcbiAgICBjb25zdCBjb21wb25lbnRPbkRlc3Ryb3kgPSBDb21wb25lbnQucHJvdG90eXBlLm9uRGVzdHJveTtcblxuICAgIGNvbnN0IGNvbm5lY3RNaXhpbiA9IF8uZGVmYXVsdHMoe30sIHtcblxuICAgICAgaW5pdGlhbGl6ZShfaW5pdE9wdGlvbnMpIHtcblxuICAgICAgICBjb25zdCBpbml0T3B0aW9ucyA9IF9pbml0T3B0aW9ucyB8fCB7fTtcblxuICAgICAgICBtaXhpbi5pbml0aWFsaXplLmNhbGwodGhpcywge1xuICAgICAgICAgIG1hcFN0YXRlVG9Qcm9wcyxcbiAgICAgICAgICBtYXBEaXNwYXRjaFRvUHJvcHMsXG4gICAgICAgICAgc3RvcmUsXG4gICAgICAgICAgcHJvcHM6IGluaXRPcHRpb25zLnByb3BzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjb21wb25lbnRJbml0aWFsaXplKSB7XG4gICAgICAgICAgY29tcG9uZW50SW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGluaXRPcHRpb25zKVxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBvbkRlc3Ryb3koKSB7XG5cbiAgICAgICAgbWl4aW4ub25EZXN0cm95LmNhbGwodGhpcyk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudE9uRGVzdHJveSkge1xuICAgICAgICAgIGNvbXBvbmVudE9uRGVzdHJveS5jYWxsKHRoaXMpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBtaXhpbik7XG5cbiAgICByZXR1cm4gQ29tcG9uZW50LmV4dGVuZChjb25uZWN0TWl4aW4pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJkaXNwYXRjaCIsInN0YXRlUHJvcHMiLCJkaXNwYXRjaFByb3BzIiwicGFyZW50UHJvcHMiLCJfIiwiZXh0ZW5kIiwia2V5IiwidmFsIiwib3B0aW9ucyIsInN0YXRlIiwidW5zZXQiLCJzaWxlbnQiLCJjaGFuZ2VzIiwiY2hhbmdpbmciLCJfY2hhbmdpbmciLCJfcHJldmlvdXNTdGF0ZSIsImNsb25lIiwiY2hhbmdlZCIsImN1cnJlbnQiLCJwcmV2IiwiZWFjaCIsIl92YWwiLCJfa2V5IiwiaXNFcXVhbCIsInB1c2giLCJsZW5ndGgiLCJfcGVuZGluZyIsImkiLCJ0cmlnZ2VyIiwiYXR0ciIsIl9vcHRpb25zIiwibWFwU3RhdGUiLCJtYXBTdGF0ZVRvUHJvcHMiLCJkZWZhdWx0TWFwU3RhdGVUb1Byb3BzIiwibWFwRGlzcGF0Y2giLCJtYXBEaXNwYXRjaFRvUHJvcHMiLCJkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIiwicHJvcHMiLCJzdG9yZSIsInN0b3JlU3RhdGUiLCJnZXRTdGF0ZSIsImRlZmF1bHRzIiwiYmluZFN0YXRlRXZlbnRzIiwiY2xlYXJDYWNoZSIsInRyeVN1YnNjcmliZSIsInN0YXRlRXZlbnRzIiwiYmluZEV2ZW50cyIsInVuYmluZEV2ZW50cyIsImZpbmFsTWFwU3RhdGVUb1Byb3BzIiwiY29uZmlndXJlRmluYWxNYXBTdGF0ZSIsImRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMiLCJtYXBwZWRTdGF0ZSIsImlzRmFjdG9yeSIsImlzRnVuY3Rpb24iLCJjb21wdXRlU3RhdGVQcm9wcyIsIm5leHRTdGF0ZVByb3BzIiwiZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMiLCJjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoIiwiZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyIsIm1hcHBlZERpc3BhdGNoIiwiY29tcHV0ZURpc3BhdGNoUHJvcHMiLCJuZXh0RGlzcGF0Y2hQcm9wcyIsInVuc3Vic2NyaWJlIiwiaXNTdWJzY3JpYmVkIiwic3Vic2NyaWJlIiwiaGFuZGxlQ2hhbmdlIiwiYmluZCIsImhhbmRsZURpc3BhdGNoUHJvcHMiLCJ0cnlVbnN1YnNjcmliZSIsInVuYmluZFN0YXRlRXZlbnRzIiwiaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQiLCJoYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCIsInVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCIsInByZXZTdG9yZVN0YXRlIiwiaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkIiwidXBkYXRlU3RhdGVQcm9wc0lmTmVlZGVkIiwibWVyZ2VkUHJvcHMiLCJkZWZhdWx0TWVyZ2VQcm9wcyIsImNvbXBvbmVudERpZFJlY2VpdmVQcm9wcyIsInNldFN0YXRlIiwiX21hcFN0YXRlVG9Qcm9wcyIsIl9tYXBEaXNwYXRjaFRvUHJvcHMiLCJDb21wb25lbnQiLCJwcm90b3R5cGUiLCJjb21wb25lbnRJbml0aWFsaXplIiwiaW5pdGlhbGl6ZSIsImNvbXBvbmVudE9uRGVzdHJveSIsIm9uRGVzdHJveSIsImNvbm5lY3RNaXhpbiIsIl9pbml0T3B0aW9ucyIsImluaXRPcHRpb25zIiwiY2FsbCIsIm1peGluIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDhCQUFlO1NBQVUsRUFBVjtDQUFmOztBQ0FBLGlDQUFlO1NBQWEsRUFBRUEsa0JBQUYsRUFBYjtDQUFmOztBQ0NBLHlCQUFlLFVBQUNDLFVBQUQsRUFBYUMsYUFBYixFQUE0QkMsV0FBNUI7U0FDYkMsRUFBRUMsTUFBRixDQUFTLEVBQVQsRUFBYUYs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