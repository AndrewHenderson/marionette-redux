// Marionette Redux
// ----------------------------------
// v0.1.6
//
// Copyright (c)2016 Andrew Henderson.
// Distributed under MIT license


(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('underscore'), require('marionette')) :
	typeof define === 'function' && define.amd ? define(['underscore', 'marionette'], factory) :
	(global.MarionetteRedux = factory(global._,global.Marionette));
}(this, (function (_,Marionette) { 'use strict';

_ = 'default' in _ ? _['default'] : _;
Marionette = 'default' in Marionette ? Marionette['default'] : Marionette;

function mapStateToProps() {
  return {};
}

function mapDispatchToProps(dispatch) {
  return {
    dispatch: dispatch
  };
}

function mergeProps(stateProps, dispatchProps, parentProps) {
  return _.extend({}, parentProps, stateProps, dispatchProps);
}

var _typeof$1 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function isDisplayComponent(Component) {
  if ((typeof Component === 'undefined' ? 'undefined' : _typeof$1(Component)) === 'object') {
    return Component instanceof Marionette.View || Component instanceof Marionette.Behavior;
  }
  if (typeof Component === 'function') {
    return Component.prototype instanceof Marionette.View || Component.prototype instanceof Marionette.Behavior;
  }
  return false;
}

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var mixin = {
  initialize: function initialize(_options) {

    var options = _options || {};

    this.mapState = options.mapStateToProps || this.mapStateToProps || mapStateToProps;
    this.mapDispatch = options.mapDispatchToProps || this.mapDispatchToProps || mapDispatchToProps;
    this.mergeProps = options.mergeProps || this.mergeProps || mergeProps;
    this.props = this.props || {};

    if (options.props) {
      _.extend(this.props, options.props);
    }

    this.store = options.store || this.store;

    if (!this.store && window && window.store) {
      this.store = window.store;
    }

    var storeState = this.store.getState();
    this.state = _.defaults({
      storeState: storeState
    }, this.getInitialState());

    this.bindStateEvents();
    this.clearCache();

    if (!isDisplayComponent(this)) {
      this.trySubscribe();
    }
  },
  getInitialState: function getInitialState() {
    return {};
  },
  setState: function setState(key, val, options) {

    if (key == null) {
      return this;
    }

    // Handle both `"key", value` and `{key: value}` -style arguments.
    var state = void 0;
    if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
      state = key;
      options = val;
    } else {
      (state = {})[key] = val;
    }

    options || (options = {});

    // Extract state and options.
    var unset = options.unset;
    var silent = options.silent;
    var changes = [];
    var changing = this._changing;
    this._changing = true;

    if (!changing) {
      this._previousState = _.clone(this.state);
      this.changed = {};
    }

    var current = this.state;
    var changed = this.changed;
    var prev = this._previousState;

    // For each `set` state, update or delete the current value.
    _.each(state, function (_val, _key) {
      if (!_.isEqual(current[_key], _val)) {
        changes.push(_key);
      }
      if (!_.isEqual(prev[_key], _val)) {
        changed[_key] = _val;
      } else {
        delete changed[_key];
      }
      unset ? delete current[_key] : current[_key] = _val;
    });

    // Trigger all relevant state changes.
    if (!silent) {
      if (changes.length) {
        this._pending = options;
      }
      for (var i = 0; i < changes.length; i++) {
        this.trigger('change:' + changes[i], this, current[changes[i]], options);
      }
    }

    // You might be wondering why there's a `while` loop here. Changes can
    // be recursively nested within `"change"` events.
    if (changing) {
      return this;
    }
    if (!silent) {
      while (this._pending) {
        options = this._pending;
        this._pending = false;
        this.trigger('change', this, options);
      }
    }
    this._pending = false;
    this._changing = false;
    return this;
  },
  getState: function getState(attr) {
    return this.state[attr];
  },
  bindStateEvents: function bindStateEvents() {
    var bind = void 0;
    if (this.stateEvents) {
      bind = Marionette.bindEvents || Marionette.bindEntityEvents;
      bind(this, this, this.stateEvents);
    }
  },
  unbindStateEvents: function unbindStateEvents() {
    var unbind = void 0;
    if (this.stateEvents) {
      unbind = Marionette.unbindEvents || Marionette.unbindEntityEvents;
      unbind(this, this, this.stateEvents);
    }
  },
  computeStateProps: function computeStateProps(store, props) {
    if (!this.finalMapStateToProps) {
      return this.configureFinalMapState(store, props);
    }

    var state = store.getState();
    var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

    return stateProps;
  },
  configureFinalMapState: function configureFinalMapState(store, props) {
    var mappedState = this.mapState(store.getState(), props);
    var isFactory = _.isFunction(mappedState);

    this.finalMapStateToProps = isFactory ? mappedState : this.mapState;
    this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

    if (isFactory) {
      return this.computeStateProps(store, props);
    }

    return mappedState;
  },
  updateStatePropsIfNeeded: function updateStatePropsIfNeeded() {
    var nextStateProps = this.computeStateProps(this.store, this.props);
    if (this.stateProps && _.isEqual(nextStateProps, this.stateProps)) {
      return false;
    }

    this.stateProps = nextStateProps;

    return true;
  },
  computeDispatchProps: function computeDispatchProps(store, props) {
    if (!this.finalMapDispatchToProps) {
      return this.configureFinalMapDispatch(store, props);
    }

    var dispatch = store.dispatch;
    var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

    return dispatchProps;
  },
  configureFinalMapDispatch: function configureFinalMapDispatch(store, props) {
    var mappedDispatch = this.mapDispatch(store.dispatch, props);
    var isFactory = _.isFunction(mappedDispatch);

    this.finalMapDispatchToProps = isFactory ? mappedDispatch : this.mapDispatch;
    this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

    if (isFactory) {
      return this.computeDispatchProps(store, props);
    }

    return mappedDispatch;
  },
  updateDispatchPropsIfNeeded: function updateDispatchPropsIfNeeded() {
    var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
    if (this.dispatchProps && _.isEqual(nextDispatchProps, this.dispatchProps)) {
      return false;
    }

    this.dispatchProps = nextDispatchProps;

    return true;
  },
  isSubscribed: function isSubscribed() {
    return _.isFunction(this.unsubscribe);
  },
  trySubscribe: function trySubscribe() {
    if (!this.isSubscribed()) {
      this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
      this.handleDispatchProps();
      this.handleChange();
    }
  },
  tryUnsubscribe: function tryUnsubscribe() {
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
  },
  onRender: function onRender() {
    this.trySubscribe();
  },
  onDestroy: function onDestroy() {
    this.tryUnsubscribe();
    this.unbindStateEvents();
    this.clearCache();
  },
  clearCache: function clearCache() {
    this.dispatchProps = null;
    this.stateProps = null;
    this.finalMapDispatchToProps = null;
    this.finalMapStateToProps = null;
    this.haveInitialStatePropsBeenDetermined = false;
    this.haveInitialDispatchPropsBeenDetermined = false;
  },
  handleDispatchProps: function handleDispatchProps() {
    if (!this.haveInitialDispatchPropsBeenDetermined) {
      this.updateDispatchPropsIfNeeded();
      this.haveInitialDispatchPropsBeenDetermined = true;
    }
  },
  handleChange: function handleChange() {
    if (!this.unsubscribe) {
      return;
    }

    var storeState = this.store.getState();
    var prevStoreState = this.getState('storeState');
    if (this.haveInitialStatePropsBeenDetermined && _.isEqual(prevStoreState, storeState)) {
      return;
    }

    var haveStatePropsChanged = this.updateStatePropsIfNeeded();
    this.haveInitialStatePropsBeenDetermined = true;

    if (haveStatePropsChanged) {

      var mergedProps = this.mergeProps(this.stateProps, this.dispatchProps, this.props);
      this.props = mergedProps;

      _.isFunction(this.componentDidReceiveProps) && this.componentDidReceiveProps(mergedProps);
    }

    this.setState({
      storeState: storeState
    });
  }
};

function connect(_mapStateToProps, _mapDispatchToProps, _mergeProps, _options) {

  var options = _options || {};

  return function (Component) {

    var mapStateToProps$$1 = _mapStateToProps || Component.prototype.mapStateToProps || mapStateToProps;
    var mapDispatchToProps$$1 = _mapDispatchToProps || Component.prototype.mapDispatchToProps || mapDispatchToProps;
    var mergeProps$$1 = _mergeProps || Component.prototype.mergeProps || mergeProps;
    var store = options.store || Component.prototype.store;
    var componentInitialize = Component.prototype.initialize;
    var componentonRender = Component.prototype.onRender;
    var componentOnDestroy = Component.prototype.onDestroy;

    var connectMixin = _.defaults({}, {
      initialize: function initialize(_initOptions) {

        var initOptions = _initOptions || {};

        mixin.initialize.call(this, {
          mapStateToProps: mapStateToProps$$1,
          mapDispatchToProps: mapDispatchToProps$$1,
          mergeProps: mergeProps$$1,
          store: store,
          props: initOptions.props
        });

        if (componentInitialize) {
          componentInitialize.apply(this, arguments);
        }
      },
      onRender: function onRender() {

        mixin.onRender.apply(this, arguments);

        if (componentonRender) {
          componentonRender.apply(this, arguments);
        }
      },
      onDestroy: function onDestroy() {

        mixin.onDestroy.apply(this, arguments);

        if (componentOnDestroy) {
          componentOnDestroy.apply(this, arguments);
        }
      }
    }, mixin);

    if (!isDisplayComponent(Component)) {
      connectMixin = _.omit(connectMixin, 'onRender');
    }

    return Component.extend(connectMixin);
  };
}

var version = "0.1.6";

var MarionetteRedux = {};

MarionetteRedux.connect = connect;
MarionetteRedux.mixin = mixin;
MarionetteRedux.VERSION = version;

return MarionetteRedux;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWFwU3RhdGVUb1Byb3BzLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9tYXBEaXNwYXRjaFRvUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21lcmdlUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2lzRGlzcGxheUNvbXBvbmVudC5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWl4aW4uanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2Nvbm5lY3QuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21hcmlvbmV0dGUtcmVkdXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKCkge1xuICByZXR1cm4ge31cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCkge1xuICByZXR1cm4ge1xuICAgIGRpc3BhdGNoOiBkaXNwYXRjaFxuICB9XG59XG4iLCJpbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1lcmdlUHJvcHMoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgcGFyZW50UHJvcHMpIHtcbiAgcmV0dXJuIF8uZXh0ZW5kKHt9LCBwYXJlbnRQcm9wcywgc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcylcbn1cbiIsImltcG9ydCBNYXJpb25ldHRlIGZyb20gJ21hcmlvbmV0dGUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzRGlzcGxheUNvbXBvbmVudChDb21wb25lbnQpIHtcbiAgaWYgKHR5cGVvZiBDb21wb25lbnQgPT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIENvbXBvbmVudCBpbnN0YW5jZW9mIE1hcmlvbmV0dGUuVmlldyB8fCBDb21wb25lbnQgaW5zdGFuY2VvZiBNYXJpb25ldHRlLkJlaGF2aW9yXG4gIH1cbiAgaWYgKHR5cGVvZiBDb21wb25lbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gQ29tcG9uZW50LnByb3RvdHlwZSBpbnN0YW5jZW9mIE1hcmlvbmV0dGUuVmlldyB8fCBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgTWFyaW9uZXR0ZS5CZWhhdmlvclxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuIiwiaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7XG5pbXBvcnQgTWFyaW9uZXR0ZSBmcm9tICdtYXJpb25ldHRlJ1xuaW1wb3J0IGRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMgZnJvbSAnLi9tYXBTdGF0ZVRvUHJvcHMnXG5pbXBvcnQgZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcyBmcm9tICcuL21hcERpc3BhdGNoVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWVyZ2VQcm9wcyBmcm9tICcuL21lcmdlUHJvcHMnXG5pbXBvcnQgaXNEaXNwbGF5Q29tcG9uZW50IGZyb20gJy4vaXNEaXNwbGF5Q29tcG9uZW50JztcblxuY29uc3QgbWl4aW4gPSB7XG5cbiAgaW5pdGlhbGl6ZShfb3B0aW9ucykge1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IF9vcHRpb25zIHx8IHt9O1xuXG4gICAgdGhpcy5tYXBTdGF0ZSA9IG9wdGlvbnMubWFwU3RhdGVUb1Byb3BzIHx8IHRoaXMubWFwU3RhdGVUb1Byb3BzIHx8IGRlZmF1bHRNYXBTdGF0ZVRvUHJvcHM7XG4gICAgdGhpcy5tYXBEaXNwYXRjaCA9IG9wdGlvbnMubWFwRGlzcGF0Y2hUb1Byb3BzIHx8IHRoaXMubWFwRGlzcGF0Y2hUb1Byb3BzIHx8IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHM7XG4gICAgdGhpcy5tZXJnZVByb3BzID0gb3B0aW9ucy5tZXJnZVByb3BzIHx8IHRoaXMubWVyZ2VQcm9wcyB8fCBkZWZhdWx0TWVyZ2VQcm9wcztcbiAgICB0aGlzLnByb3BzID0gdGhpcy5wcm9wcyB8fCB7fTtcblxuICAgIGlmIChvcHRpb25zLnByb3BzKSB7XG4gICAgICBfLmV4dGVuZCh0aGlzLnByb3BzLCBvcHRpb25zLnByb3BzKVxuICAgIH1cblxuICAgIHRoaXMuc3RvcmUgPSBvcHRpb25zLnN0b3JlIHx8IHRoaXMuc3RvcmVcblxuICAgIGlmICghdGhpcy5zdG9yZSAmJiB3aW5kb3cgJiYgd2luZG93LnN0b3JlKSB7XG4gICAgICB0aGlzLnN0b3JlID0gd2luZG93LnN0b3JlXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICB0aGlzLnN0YXRlID0gXy5kZWZhdWx0cyh7XG4gICAgICBzdG9yZVN0YXRlOiBzdG9yZVN0YXRlXG4gICAgfSwgdGhpcy5nZXRJbml0aWFsU3RhdGUoKSk7XG5cbiAgICB0aGlzLmJpbmRTdGF0ZUV2ZW50cygpO1xuICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuXG4gICAgaWYgKCFpc0Rpc3BsYXlDb21wb25lbnQodGhpcykpIHtcbiAgICAgIHRoaXMudHJ5U3Vic2NyaWJlKClcbiAgICB9XG4gIH0sXG5cbiAgZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgIHJldHVybiB7fVxuICB9LFxuXG4gIHNldFN0YXRlKGtleSwgdmFsLCBvcHRpb25zKSB7XG5cbiAgICBpZiAoa2V5ID09IG51bGwpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSBib3RoIGBcImtleVwiLCB2YWx1ZWAgYW5kIGB7a2V5OiB2YWx1ZX1gIC1zdHlsZSBhcmd1bWVudHMuXG4gICAgbGV0IHN0YXRlO1xuICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgc3RhdGUgPSBrZXk7XG4gICAgICBvcHRpb25zID0gdmFsO1xuICAgIH0gZWxzZSB7XG4gICAgICAoc3RhdGUgPSB7fSlba2V5XSA9IHZhbDtcbiAgICB9XG5cbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gICAgLy8gRXh0cmFjdCBzdGF0ZSBhbmQgb3B0aW9ucy5cbiAgICBjb25zdCB1bnNldCAgICAgID0gb3B0aW9ucy51bnNldDtcbiAgICBjb25zdCBzaWxlbnQgICAgID0gb3B0aW9ucy5zaWxlbnQ7XG4gICAgY29uc3QgY2hhbmdlcyAgICA9IFtdO1xuICAgIGNvbnN0IGNoYW5naW5nICAgPSB0aGlzLl9jaGFuZ2luZztcbiAgICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7XG5cbiAgICBpZiAoIWNoYW5naW5nKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c1N0YXRlID0gXy5jbG9uZSh0aGlzLnN0YXRlKTtcbiAgICAgIHRoaXMuY2hhbmdlZCA9IHt9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNoYW5nZWQgPSB0aGlzLmNoYW5nZWQ7XG4gICAgY29uc3QgcHJldiAgICA9IHRoaXMuX3ByZXZpb3VzU3RhdGU7XG5cbiAgICAvLyBGb3IgZWFjaCBgc2V0YCBzdGF0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS5cbiAgICBfLmVhY2goc3RhdGUsIGZ1bmN0aW9uKF92YWwsIF9rZXkpIHtcbiAgICAgIGlmICghXy5pc0VxdWFsKGN1cnJlbnRbX2tleV0sIF92YWwpKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaChfa2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbX2tleV0sIF92YWwpKSB7XG4gICAgICAgIGNoYW5nZWRbX2tleV0gPSBfdmFsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVsZXRlIGNoYW5nZWRbX2tleV07XG4gICAgICB9XG4gICAgICB1bnNldCA/IGRlbGV0ZSBjdXJyZW50W19rZXldIDogY3VycmVudFtfa2V5XSA9IF92YWw7XG4gICAgfSk7XG5cbiAgICAvLyBUcmlnZ2VyIGFsbCByZWxldmFudCBzdGF0ZSBjaGFuZ2VzLlxuICAgIGlmICghc2lsZW50KSB7XG4gICAgICBpZiAoY2hhbmdlcy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFlvdSBtaWdodCBiZSB3b25kZXJpbmcgd2h5IHRoZXJlJ3MgYSBgd2hpbGVgIGxvb3AgaGVyZS4gQ2hhbmdlcyBjYW5cbiAgICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGBcImNoYW5nZVwiYCBldmVudHMuXG4gICAgaWYgKGNoYW5naW5nKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaWYgKCFzaWxlbnQpIHtcbiAgICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLl9wZW5kaW5nO1xuICAgICAgICB0aGlzLl9wZW5kaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlO1xuICAgIHJldHVybiB0aGlzXG4gIH0sXG5cbiAgZ2V0U3RhdGUoYXR0cikge1xuICAgIHJldHVybiB0aGlzLnN0YXRlW2F0dHJdXG4gIH0sXG5cbiAgYmluZFN0YXRlRXZlbnRzKCkge1xuICAgIGxldCBiaW5kO1xuICAgIGlmICh0aGlzLnN0YXRlRXZlbnRzKSB7XG4gICAgICBiaW5kID0gTWFyaW9uZXR0ZS5iaW5kRXZlbnRzIHx8IE1hcmlvbmV0dGUuYmluZEVudGl0eUV2ZW50cztcbiAgICAgIGJpbmQodGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgdW5iaW5kU3RhdGVFdmVudHMoKSB7XG4gICAgbGV0IHVuYmluZDtcbiAgICBpZiAodGhpcy5zdGF0ZUV2ZW50cykge1xuICAgICAgdW5iaW5kID0gTWFyaW9uZXR0ZS51bmJpbmRFdmVudHMgfHwgTWFyaW9uZXR0ZS51bmJpbmRFbnRpdHlFdmVudHM7XG4gICAgICB1bmJpbmQodGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZVN0YXRlUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcFN0YXRlKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3Qgc3RhdGVQcm9wcyA9IHRoaXMuZG9TdGF0ZVByb3BzRGVwZW5kT25Pd25Qcm9wcyA/XG4gICAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKHN0YXRlLCBwcm9wcykgOlxuICAgICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSk7XG5cbiAgICByZXR1cm4gc3RhdGVQcm9wc1xuICB9LFxuXG4gIGNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUoc3RvcmUsIHByb3BzKSB7XG4gICAgY29uc3QgbWFwcGVkU3RhdGUgPSB0aGlzLm1hcFN0YXRlKHN0b3JlLmdldFN0YXRlKCksIHByb3BzKTtcbiAgICBjb25zdCBpc0ZhY3RvcnkgPSBfLmlzRnVuY3Rpb24obWFwcGVkU3RhdGUpO1xuXG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IGlzRmFjdG9yeSA/IG1hcHBlZFN0YXRlIDogdGhpcy5tYXBTdGF0ZTtcbiAgICB0aGlzLmRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMgPSB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzLmxlbmd0aCAhPT0gMTtcblxuICAgIGlmIChpc0ZhY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICByZXR1cm4gbWFwcGVkU3RhdGVcbiAgfSxcblxuICB1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQoKSB7XG4gICAgY29uc3QgbmV4dFN0YXRlUHJvcHMgPSB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHRoaXMuc3RvcmUsIHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLnN0YXRlUHJvcHMgJiYgXy5pc0VxdWFsKG5leHRTdGF0ZVByb3BzLCB0aGlzLnN0YXRlUHJvcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlUHJvcHMgPSBuZXh0U3RhdGVQcm9wcztcblxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaCA9IHN0b3JlLmRpc3BhdGNoO1xuICAgIGNvbnN0IGRpc3BhdGNoUHJvcHMgPSB0aGlzLmRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMgP1xuICAgICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCwgcHJvcHMpIDpcbiAgICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpO1xuXG4gICAgcmV0dXJuIGRpc3BhdGNoUHJvcHNcbiAgfSxcblxuICBjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcykge1xuICAgIGNvbnN0IG1hcHBlZERpc3BhdGNoID0gdGhpcy5tYXBEaXNwYXRjaChzdG9yZS5kaXNwYXRjaCwgcHJvcHMpO1xuICAgIGNvbnN0IGlzRmFjdG9yeSA9IF8uaXNGdW5jdGlvbihtYXBwZWREaXNwYXRjaCk7XG5cbiAgICB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzID0gaXNGYWN0b3J5ID8gbWFwcGVkRGlzcGF0Y2ggOiB0aGlzLm1hcERpc3BhdGNoO1xuICAgIHRoaXMuZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyA9IHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMubGVuZ3RoICE9PSAxO1xuXG4gICAgaWYgKGlzRmFjdG9yeSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKVxuICAgIH1cblxuICAgIHJldHVybiBtYXBwZWREaXNwYXRjaFxuICB9LFxuXG4gIHVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpIHtcbiAgICBjb25zdCBuZXh0RGlzcGF0Y2hQcm9wcyA9IHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHModGhpcy5zdG9yZSwgdGhpcy5wcm9wcyk7XG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hQcm9wcyAmJiBfLmlzRXF1YWwobmV4dERpc3BhdGNoUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcykpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMuZGlzcGF0Y2hQcm9wcyA9IG5leHREaXNwYXRjaFByb3BzO1xuXG4gICAgcmV0dXJuIHRydWVcbiAgfSxcblxuICBpc1N1YnNjcmliZWQoKSB7XG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbih0aGlzLnVuc3Vic2NyaWJlKVxuICB9LFxuXG4gIHRyeVN1YnNjcmliZSgpIHtcbiAgICBpZiAoIXRoaXMuaXNTdWJzY3JpYmVkKCkpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSB0aGlzLnN0b3JlLnN1YnNjcmliZSh0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuaGFuZGxlRGlzcGF0Y2hQcm9wcygpO1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoKVxuICAgIH1cbiAgfSxcblxuICB0cnlVbnN1YnNjcmliZSgpIHtcbiAgICBpZiAodGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgb25SZW5kZXIoKSB7XG4gICAgdGhpcy50cnlTdWJzY3JpYmUoKVxuICB9LFxuXG4gIG9uRGVzdHJveSgpIHtcbiAgICB0aGlzLnRyeVVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy51bmJpbmRTdGF0ZUV2ZW50cygpO1xuICAgIHRoaXMuY2xlYXJDYWNoZSgpXG4gIH0sXG5cbiAgY2xlYXJDYWNoZSgpIHtcbiAgICB0aGlzLmRpc3BhdGNoUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuc3RhdGVQcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IGZhbHNlO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxEaXNwYXRjaFByb3BzQmVlbkRldGVybWluZWQgPSBmYWxzZVxuICB9LFxuXG4gIGhhbmRsZURpc3BhdGNoUHJvcHMoKSB7XG4gICAgaWYgKCF0aGlzLmhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkKSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5oYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IHRydWVcbiAgICB9XG4gIH0sXG5cbiAgaGFuZGxlQ2hhbmdlKCkge1xuICAgIGlmICghdGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBjb25zdCBwcmV2U3RvcmVTdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoJ3N0b3JlU3RhdGUnKTtcbiAgICBpZiAodGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCAmJiBfLmlzRXF1YWwocHJldlN0b3JlU3RhdGUsIHN0b3JlU3RhdGUpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBoYXZlU3RhdGVQcm9wc0NoYW5nZWQgPSB0aGlzLnVwZGF0ZVN0YXRlUHJvcHNJZk5lZWRlZCgpO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQgPSB0cnVlO1xuXG4gICAgaWYgKGhhdmVTdGF0ZVByb3BzQ2hhbmdlZCkge1xuXG4gICAgICBjb25zdCBtZXJnZWRQcm9wcyA9IHRoaXMubWVyZ2VQcm9wcyh0aGlzLnN0YXRlUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcywgdGhpcy5wcm9wcyk7XG4gICAgICB0aGlzLnByb3BzID0gbWVyZ2VkUHJvcHM7XG5cbiAgICAgIF8uaXNGdW5jdGlvbih0aGlzLmNvbXBvbmVudERpZFJlY2VpdmVQcm9wcykgJiYgdGhpcy5jb21wb25lbnREaWRSZWNlaXZlUHJvcHMobWVyZ2VkUHJvcHMpXG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzdG9yZVN0YXRlXG4gICAgfSlcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgbWl4aW47XG4iLCJpbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmltcG9ydCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzIGZyb20gJy4vbWFwU3RhdGVUb1Byb3BzJ1xuaW1wb3J0IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHMgZnJvbSAnLi9tYXBEaXNwYXRjaFRvUHJvcHMnXG5pbXBvcnQgZGVmYXVsdE1lcmdlUHJvcHMgZnJvbSAnLi9tZXJnZVByb3BzJ1xuaW1wb3J0IG1peGluIGZyb20gJy4vbWl4aW4nXG5pbXBvcnQgaXNEaXNwbGF5Q29tcG9uZW50IGZyb20gJy4vaXNEaXNwbGF5Q29tcG9uZW50JztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY29ubmVjdChfbWFwU3RhdGVUb1Byb3BzLCBfbWFwRGlzcGF0Y2hUb1Byb3BzLCBfbWVyZ2VQcm9wcywgX29wdGlvbnMpIHtcblxuICBjb25zdCBvcHRpb25zID0gX29wdGlvbnMgfHwge307XG5cbiAgcmV0dXJuIGZ1bmN0aW9uKENvbXBvbmVudCkge1xuXG4gICAgY29uc3QgbWFwU3RhdGVUb1Byb3BzID0gX21hcFN0YXRlVG9Qcm9wcyB8fCBDb21wb25lbnQucHJvdG90eXBlLm1hcFN0YXRlVG9Qcm9wcyB8fCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzO1xuICAgIGNvbnN0IG1hcERpc3BhdGNoVG9Qcm9wcyA9IF9tYXBEaXNwYXRjaFRvUHJvcHMgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5tYXBEaXNwYXRjaFRvUHJvcHMgfHwgZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcztcbiAgICBjb25zdCBtZXJnZVByb3BzID0gX21lcmdlUHJvcHMgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5tZXJnZVByb3BzIHx8IGRlZmF1bHRNZXJnZVByb3BzO1xuICAgIGNvbnN0IHN0b3JlID0gb3B0aW9ucy5zdG9yZSB8fCBDb21wb25lbnQucHJvdG90eXBlLnN0b3JlO1xuICAgIGNvbnN0IGNvbXBvbmVudEluaXRpYWxpemUgPSBDb21wb25lbnQucHJvdG90eXBlLmluaXRpYWxpemU7XG4gICAgY29uc3QgY29tcG9uZW50b25SZW5kZXIgPSBDb21wb25lbnQucHJvdG90eXBlLm9uUmVuZGVyO1xuICAgIGNvbnN0IGNvbXBvbmVudE9uRGVzdHJveSA9IENvbXBvbmVudC5wcm90b3R5cGUub25EZXN0cm95O1xuXG4gICAgbGV0IGNvbm5lY3RNaXhpbiA9IF8uZGVmYXVsdHMoe30sIHtcblxuICAgICAgaW5pdGlhbGl6ZShfaW5pdE9wdGlvbnMpIHtcblxuICAgICAgICBjb25zdCBpbml0T3B0aW9ucyA9IF9pbml0T3B0aW9ucyB8fCB7fTtcblxuICAgICAgICBtaXhpbi5pbml0aWFsaXplLmNhbGwodGhpcywge1xuICAgICAgICAgIG1hcFN0YXRlVG9Qcm9wcyxcbiAgICAgICAgICBtYXBEaXNwYXRjaFRvUHJvcHMsXG4gICAgICAgICAgbWVyZ2VQcm9wcyxcbiAgICAgICAgICBzdG9yZSxcbiAgICAgICAgICBwcm9wczogaW5pdE9wdGlvbnMucHJvcHNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudEluaXRpYWxpemUpIHtcbiAgICAgICAgICBjb21wb25lbnRJbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIG9uUmVuZGVyKCkge1xuXG4gICAgICAgIG1peGluLm9uUmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudG9uUmVuZGVyKSB7XG4gICAgICAgICAgY29tcG9uZW50b25SZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBvbkRlc3Ryb3koKSB7XG5cbiAgICAgICAgbWl4aW4ub25EZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudE9uRGVzdHJveSkge1xuICAgICAgICAgIGNvbXBvbmVudE9uRGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgbWl4aW4pO1xuXG4gICAgaWYgKCFpc0Rpc3BsYXlDb21wb25lbnQoQ29tcG9uZW50KSkge1xuICAgICAgY29ubmVjdE1peGluID0gXy5vbWl0KGNvbm5lY3RNaXhpbiwgJ29uUmVuZGVyJylcbiAgICB9XG5cbiAgICByZXR1cm4gQ29tcG9uZW50LmV4dGVuZChjb25uZWN0TWl4aW4pXG4gIH1cbn1cbiIsImltcG9ydCBjb25uZWN0IGZyb20gJy4vY29ubmVjdCdcbmltcG9ydCBtaXhpbiBmcm9tICcuL21peGluJ1xuaW1wb3J0IHsgdmVyc2lvbiB9IGZyb20gJy4uL3BhY2thZ2UuanNvbidcblxuY29uc3QgTWFyaW9uZXR0ZVJlZHV4ID0ge307XG5cbk1hcmlvbmV0dGVSZWR1eC5jb25uZWN0ID0gY29ubmVjdDtcbk1hcmlvbmV0dGVSZWR1eC5taXhpbiA9IG1peGluO1xuTWFyaW9uZXR0ZVJlZHV4LlZFUlNJT04gPSB2ZXJzaW9uO1xuXG5leHBvcnQgZGVmYXVsdCBNYXJpb25ldHRlUmVkdXg7XG4iXSwibmFtZXMiOlsibWFwU3RhdGVUb1Byb3BzIiwibWFwRGlzcGF0Y2hUb1Byb3BzIiwiZGlzcGF0Y2giLCJtZXJnZVByb3BzIiwic3RhdGVQcm9wcyIsImRpc3BhdGNoUHJvcHMiLCJwYXJlbnRQcm9wcyIsIl8iLCJleHRlbmQiLCJpc0Rpc3BsYXlDb21wb25lbnQiLCJDb21wb25lbnQiLCJNYXJpb25ldHRlIiwiVmlldyIsIkJlaGF2aW9yIiwicHJvdG90eXBlIiwibWl4aW4iLCJfb3B0aW9ucyIsIm9wdGlvbnMiLCJtYXBTdGF0ZSIsImRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMiLCJtYXBEaXNwYXRjaCIsImRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHMiLCJkZWZhdWx0TWVyZ2VQcm9wcyIsInByb3BzIiwic3RvcmUiLCJ3aW5kb3ciLCJzdG9yZVN0YXRlIiwiZ2V0U3RhdGUiLCJzdGF0ZSIsImRlZmF1bHRzIiwiZ2V0SW5pdGlhbFN0YXRlIiwiYmluZFN0YXRlRXZlbnRzIiwiY2xlYXJDYWNoZSIsInRyeVN1YnNjcmliZSIsImtleSIsInZhbCIsInVuc2V0Iiwic2lsZW50IiwiY2hhbmdlcyIsImNoYW5naW5nIiwiX2NoYW5naW5nIiwiX3ByZXZpb3VzU3RhdGUiLCJjbG9uZSIsImNoYW5nZWQiLCJjdXJyZW50IiwicHJldiIsImVhY2giLCJfdmFsIiwiX2tleSIsImlzRXF1YWwiLCJwdXNoIiwibGVuZ3RoIiwiX3BlbmRpbmciLCJpIiwidHJpZ2dlciIsImF0dHIiLCJiaW5kIiwic3RhdGVFdmVudHMiLCJiaW5kRXZlbnRzIiwiYmluZEVudGl0eUV2ZW50cyIsInVuYmluZCIsInVuYmluZEV2ZW50cyIsInVuYmluZEVudGl0eUV2ZW50cyIsImZpbmFsTWFwU3RhdGVUb1Byb3BzIiwiY29uZmlndXJlRmluYWxNYXBTdGF0ZSIsImRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMiLCJtYXBwZWRTdGF0ZSIsImlzRmFjdG9yeSIsImlzRnVuY3Rpb24iLCJjb21wdXRlU3RhdGVQcm9wcyIsIm5leHRTdGF0ZVByb3BzIiwiZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMiLCJjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoIiwiZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyIsIm1hcHBlZERpc3BhdGNoIiwiY29tcHV0ZURpc3BhdGNoUHJvcHMiLCJuZXh0RGlzcGF0Y2hQcm9wcyIsInVuc3Vic2NyaWJlIiwiaXNTdWJzY3JpYmVkIiwic3Vic2NyaWJlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlRGlzcGF0Y2hQcm9wcyIsInRyeVVuc3Vic2NyaWJlIiwidW5iaW5kU3RhdGVFdmVudHMiLCJoYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCIsImhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkIiwidXBkYXRlRGlzcGF0Y2hQcm9wc0lmTmVlZGVkIiwicHJldlN0b3JlU3RhdGUiLCJoYXZlU3RhdGVQcm9wc0NoYW5nZWQiLCJ1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQiLCJtZXJnZWRQcm9wcyIsImNvbXBvbmVudERpZFJlY2VpdmVQcm9wcyIsInNldFN0YXRlIiwiY29ubmVjdCIsIl9tYXBTdGF0ZVRvUHJvcHMiLCJfbWFwRGlzcGF0Y2hUb1Byb3BzIiwiX21lcmdlUHJvcHMiLCJjb21wb25lbnRJbml0aWFsaXplIiwiaW5pdGlhbGl6ZSIsImNvbXBvbmVudG9uUmVuZGVyIiwib25SZW5kZXIiLCJjb21wb25lbnRPbkRlc3Ryb3kiLCJvbkRlc3Ryb3kiLCJjb25uZWN0TWl4aW4iLCJfaW5pdE9wdGlvbnMiLCJpbml0T3B0aW9ucyIsImNhbGwiLCJhcHBseSIsImFyZ3VtZW50cyIsIm9taXQiLCJNYXJpb25ldHRlUmVkdXgiLCJWRVJTSU9OIiwidmVyc2lvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBZSxTQUFTQSxlQUFULEdBQTJCO1NBQ2pDLEVBQVA7OztBQ0RhLFNBQVNDLGtCQUFULENBQTRCQyxRQUE1QixFQUFzQztTQUM1QztjQUNLQTtHQURaOzs7QUNBYSxTQUFTQyxVQUFULENBQW9CQyxVQUFwQixFQUFnQ0MsYUFBaEMsRUFBK0NDLFdBQS9DLEVBQTREO1NBQ2xFQyxFQUFFQyxNQUFGLENBQVMsRUFBVCxFQUFhRixXQUFiLEVBQTBCRixVQUExQixFQUFzQ0MsYUFBdEMsQ0FBUDs7Ozs7QUNGRixBQUVBLEFBQWUsU0FBU0ksa0JBQVQsQ0FBNEJDLFNBQTVCLEVBQXVDO01BQ2hELFFBQU9BLFNBQVAsMkNBQU9BLFNBQVAsT0FBcUIsUUFBekIsRUFBbUM7V0FDMUJBLHFCQUFxQkMsV0FBV0MsSUFBaEMsSUFBd0NGLHFCQUFxQkMsV0FBV0UsUUFBL0U7O01BRUUsT0FBT0gsU0FBUCxLQUFxQixVQUF6QixFQUFxQztXQUM1QkEsVUFBVUksU0FBVixZQUErQkgsV0FBV0MsSUFBMUMsSUFBa0RGLFVBQVVJLFNBQVYsWUFBK0JILFdBQVdFLFFBQW5HOztTQUVLLEtBQVA7Ozs7O0FDVEYsQUFDQSxBQUNBLEFBQ0EsQUFDQSxBQUNBLEFBRUEsSUFBTUUsUUFBUTtZQUFBLHNCQUVEQyxRQUZDLEVBRVM7O1FBRWJDLFVBQVVELFlBQVksRUFBNUI7O1NBRUtFLFFBQUwsR0FBZ0JELFFBQVFqQixlQUFS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