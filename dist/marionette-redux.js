// Marionette Redux
// ----------------------------------
// v0.2.0
//
// Copyright (c)2017 Andrew Henderson.
// Distributed under MIT license


(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('underscore'), require('marionette')) :
	typeof define === 'function' && define.amd ? define(['underscore', 'marionette'], factory) :
	(global.MarionetteRedux = factory(global._,global.Marionette));
}(this, (function (underscore,marionette) { 'use strict';

function mapStateToProps() {
  return {};
}

function mapDispatchToProps(dispatch) {
  return {
    dispatch: dispatch
  };
}

function mergeProps(stateProps, dispatchProps, parentProps) {
  return underscore.extend({}, parentProps, stateProps, dispatchProps);
}

function isDisplayComponent(Component) {
  if (underscore.isFunction(Component)) {
    return Component.prototype instanceof marionette.View || Component.prototype instanceof marionette.Behavior;
  }
  if (underscore.isObject(Component)) {
    return Component instanceof marionette.View || Component instanceof marionette.Behavior;
  }
  return false;
}

var mixin = {
  initialize: function initialize(_options) {

    var options = _options || {};

    this.mapState = options.mapStateToProps || this.mapStateToProps || mapStateToProps;
    this.mapDispatch = options.mapDispatchToProps || this.mapDispatchToProps || mapDispatchToProps;
    this.mergeProps = options.mergeProps || this.mergeProps || mergeProps;
    this.props = this.props || {};

    if (options.props) {
      underscore.extend(this.props, options.props);
    }

    this.store = options.store || this.store;

    if (!this.store && window && window.store) {
      this.store = window.store;
    }

    var storeState = this.store.getState();
    this.state = underscore.defaults({
      storeState: storeState
    }, this.getInitialState());

    this.bindStateEvents();
    this.clearCache();

    if (!isDisplayComponent(this)) {
      this.trySubscribe();
    }
  },
  getInitialState: function getInitialState() {
    return {};
  },
  setState: function setState(key, val, options) {

    if (key == null) {
      return this;
    }

    // Handle both `"key", value` and `{key: value}` -style arguments.
    var state = void 0;
    if (underscore.isObject(key)) {
      state = key;
      options = val;
    } else {
      (state = {})[key] = val;
    }

    options || (options = {});

    // Extract state and options.
    var unset = options.unset;
    var silent = options.silent;
    var changes = [];
    var changing = this._changing;
    this._changing = true;

    if (!changing) {
      this._previousState = underscore.clone(this.state);
      this.changed = {};
    }

    var current = this.state;
    var changed = this.changed;
    var prev = this._previousState;

    // For each `set` state, update or delete the current value.
    underscore.each(state, function (_val, _key) {
      if (!underscore.isEqual(current[_key], _val)) {
        changes.push(_key);
      }
      if (!underscore.isEqual(prev[_key], _val)) {
        changed[_key] = _val;
      } else {
        delete changed[_key];
      }
      unset ? delete current[_key] : current[_key] = _val;
    });

    // Trigger all relevant state changes.
    if (!silent) {
      if (changes.length) {
        this._pending = options;
      }
      for (var i = 0; i < changes.length; i++) {
        this.trigger('change:' + changes[i], this, current[changes[i]], options);
      }
    }

    // You might be wondering why there's a `while` loop here. Changes can
    // be recursively nested within `"change"` events.
    if (changing) {
      return this;
    }
    if (!silent) {
      while (this._pending) {
        options = this._pending;
        this._pending = false;
        this.trigger('change', this, options);
      }
    }
    this._pending = false;
    this._changing = false;
    return this;
  },
  getState: function getState(attr) {
    return this.state[attr];
  },
  bindStateEvents: function bindStateEvents() {
    var bind = marionette.bindEvents || marionette.bindEntityEvents;
    if (this.stateEvents) {
      bind(this, this, this.stateEvents);
    }
  },
  unbindStateEvents: function unbindStateEvents() {
    var unbind = marionette.unbindEvents || marionette.unbindEntityEvents;
    if (this.stateEvents) {
      unbind(this, this, this.stateEvents);
    }
  },
  computeStateProps: function computeStateProps(store, props) {
    if (!this.finalMapStateToProps) {
      return this.configureFinalMapState(store, props);
    }

    var state = store.getState();
    var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

    return stateProps;
  },
  configureFinalMapState: function configureFinalMapState(store, props) {
    var mappedState = this.mapState(store.getState(), props);
    var isFactory = underscore.isFunction(mappedState);

    this.finalMapStateToProps = isFactory ? mappedState : this.mapState;
    this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

    if (isFactory) {
      return this.computeStateProps(store, props);
    }

    return mappedState;
  },
  updateStatePropsIfNeeded: function updateStatePropsIfNeeded() {
    var nextStateProps = this.computeStateProps(this.store, this.props);
    if (this.stateProps && underscore.isEqual(nextStateProps, this.stateProps)) {
      return false;
    }

    this.stateProps = nextStateProps;

    return true;
  },
  computeDispatchProps: function computeDispatchProps(store, props) {
    if (!this.finalMapDispatchToProps) {
      return this.configureFinalMapDispatch(store, props);
    }

    var dispatch = store.dispatch;
    var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

    return dispatchProps;
  },
  configureFinalMapDispatch: function configureFinalMapDispatch(store, props) {
    var mappedDispatch = this.mapDispatch(store.dispatch, props);
    var isFactory = underscore.isFunction(mappedDispatch);

    this.finalMapDispatchToProps = isFactory ? mappedDispatch : this.mapDispatch;
    this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

    if (isFactory) {
      return this.computeDispatchProps(store, props);
    }

    return mappedDispatch;
  },
  updateDispatchPropsIfNeeded: function updateDispatchPropsIfNeeded() {
    var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
    if (this.dispatchProps && underscore.isEqual(nextDispatchProps, this.dispatchProps)) {
      return false;
    }

    this.dispatchProps = nextDispatchProps;

    return true;
  },
  isSubscribed: function isSubscribed() {
    return underscore.isFunction(this.unsubscribe);
  },
  trySubscribe: function trySubscribe() {
    if (!this.isSubscribed()) {
      this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
      this.handleDispatchProps();
      this.handleChange();
    }
  },
  tryUnsubscribe: function tryUnsubscribe() {
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
  },
  onRender: function onRender() {
    this.trySubscribe();
  },
  onDestroy: function onDestroy() {
    this.tryUnsubscribe();
    this.unbindStateEvents();
    this.clearCache();
  },
  clearCache: function clearCache() {
    this.dispatchProps = null;
    this.stateProps = null;
    this.finalMapDispatchToProps = null;
    this.finalMapStateToProps = null;
    this.haveInitialStatePropsBeenDetermined = false;
    this.haveInitialDispatchPropsBeenDetermined = false;
  },
  handleDispatchProps: function handleDispatchProps() {
    if (!this.haveInitialDispatchPropsBeenDetermined) {
      this.updateDispatchPropsIfNeeded();
      this.haveInitialDispatchPropsBeenDetermined = true;
    }
  },
  handleChange: function handleChange() {
    if (!this.unsubscribe) {
      return;
    }

    var storeState = this.store.getState();
    var prevStoreState = this.getState('storeState');
    if (this.haveInitialStatePropsBeenDetermined && underscore.isEqual(prevStoreState, storeState)) {
      return;
    }

    var haveStatePropsChanged = this.updateStatePropsIfNeeded();
    this.haveInitialStatePropsBeenDetermined = true;

    if (haveStatePropsChanged) {

      var mergedProps = this.mergeProps(this.stateProps, this.dispatchProps, this.props);
      this.props = mergedProps;

      underscore.isFunction(this.componentDidReceiveProps) && this.componentDidReceiveProps(mergedProps);
    }

    this.setState({
      storeState: storeState
    });
  }
};

function connect(_mapStateToProps, _mapDispatchToProps, _mergeProps, _options) {

  var options = _options || {};

  return function (Component) {

    var mapStateToProps$$1 = _mapStateToProps || Component.prototype.mapStateToProps || mapStateToProps;
    var mapDispatchToProps$$1 = _mapDispatchToProps || Component.prototype.mapDispatchToProps || mapDispatchToProps;
    var mergeProps$$1 = _mergeProps || Component.prototype.mergeProps || mergeProps;
    var store = options.store || Component.prototype.store;
    var componentInitialize = Component.prototype.initialize;
    var componentonRender = Component.prototype.onRender;
    var componentOnDestroy = Component.prototype.onDestroy;

    var connectMixin = underscore.defaults({}, {
      initialize: function initialize(_initOptions) {

        var initOptions = _initOptions || {};

        mixin.initialize.call(this, {
          mapStateToProps: mapStateToProps$$1,
          mapDispatchToProps: mapDispatchToProps$$1,
          mergeProps: mergeProps$$1,
          store: store,
          props: initOptions.props
        });

        if (componentInitialize) {
          componentInitialize.apply(this, arguments);
        }
      },
      onRender: function onRender() {

        mixin.onRender.apply(this, arguments);

        if (componentonRender) {
          componentonRender.apply(this, arguments);
        }
      },
      onDestroy: function onDestroy() {

        mixin.onDestroy.apply(this, arguments);

        if (componentOnDestroy) {
          componentOnDestroy.apply(this, arguments);
        }
      }
    }, mixin);

    if (!isDisplayComponent(Component)) {
      connectMixin = underscore.omit(connectMixin, 'onRender');
    }

    return Component.extend(connectMixin);
  };
}

var version = "0.2.0";

var MarionetteRedux = {
  connect: connect,
  mixin: mixin,
  VERSION: version
};

return MarionetteRedux;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWFwU3RhdGVUb1Byb3BzLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9tYXBEaXNwYXRjaFRvUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21lcmdlUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2lzRGlzcGxheUNvbXBvbmVudC5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWl4aW4uanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL2Nvbm5lY3QuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21hcmlvbmV0dGUtcmVkdXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKCkge1xuICByZXR1cm4ge31cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCkge1xuICByZXR1cm4ge1xuICAgIGRpc3BhdGNoOiBkaXNwYXRjaFxuICB9XG59XG4iLCJpbXBvcnQgeyBleHRlbmQgfSBmcm9tICd1bmRlcnNjb3JlJztcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1lcmdlUHJvcHMoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgcGFyZW50UHJvcHMpIHtcbiAgcmV0dXJuIGV4dGVuZCh7fSwgcGFyZW50UHJvcHMsIHN0YXRlUHJvcHMsIGRpc3BhdGNoUHJvcHMpXG59XG4iLCJpbXBvcnQgeyBpc09iamVjdCwgaXNGdW5jdGlvbiB9IGZyb20gJ3VuZGVyc2NvcmUnXG5pbXBvcnQgeyBWaWV3LCBCZWhhdmlvciB9IGZyb20gJ21hcmlvbmV0dGUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzRGlzcGxheUNvbXBvbmVudChDb21wb25lbnQpIHtcbiAgaWYgKGlzRnVuY3Rpb24oQ29tcG9uZW50KSkge1xuICAgIHJldHVybiBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgVmlldyB8fCBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgQmVoYXZpb3JcbiAgfVxuICBpZiAoaXNPYmplY3QoQ29tcG9uZW50KSkge1xuICAgIHJldHVybiBDb21wb25lbnQgaW5zdGFuY2VvZiBWaWV3IHx8IENvbXBvbmVudCBpbnN0YW5jZW9mIEJlaGF2aW9yXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG4iLCJpbXBvcnQge1xuICBleHRlbmQsXG4gIGRlZmF1bHRzLFxuICBjbG9uZSxcbiAgZWFjaCxcbiAgaXNFcXVhbCxcbiAgaXNGdW5jdGlvbixcbiAgaXNPYmplY3Rcbn0gZnJvbSAndW5kZXJzY29yZSc7XG5pbXBvcnQge1xuICBiaW5kRXZlbnRzLFxuICBiaW5kRW50aXR5RXZlbnRzLFxuICB1bmJpbmRFdmVudHMsXG4gIHVuYmluZEVudGl0eUV2ZW50c1xufSBmcm9tICdtYXJpb25ldHRlJztcbmltcG9ydCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzIGZyb20gJy4vbWFwU3RhdGVUb1Byb3BzJztcbmltcG9ydCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIGZyb20gJy4vbWFwRGlzcGF0Y2hUb1Byb3BzJztcbmltcG9ydCBkZWZhdWx0TWVyZ2VQcm9wcyBmcm9tICcuL21lcmdlUHJvcHMnO1xuaW1wb3J0IGlzRGlzcGxheUNvbXBvbmVudCBmcm9tICcuL2lzRGlzcGxheUNvbXBvbmVudCc7XG5cbmNvbnN0IG1peGluID0ge1xuXG4gIGluaXRpYWxpemUoX29wdGlvbnMpIHtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBfb3B0aW9ucyB8fCB7fTtcblxuICAgIHRoaXMubWFwU3RhdGUgPSBvcHRpb25zLm1hcFN0YXRlVG9Qcm9wcyB8fCB0aGlzLm1hcFN0YXRlVG9Qcm9wcyB8fCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzO1xuICAgIHRoaXMubWFwRGlzcGF0Y2ggPSBvcHRpb25zLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCB0aGlzLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzO1xuICAgIHRoaXMubWVyZ2VQcm9wcyA9IG9wdGlvbnMubWVyZ2VQcm9wcyB8fCB0aGlzLm1lcmdlUHJvcHMgfHwgZGVmYXVsdE1lcmdlUHJvcHM7XG4gICAgdGhpcy5wcm9wcyA9IHRoaXMucHJvcHMgfHwge307XG5cbiAgICBpZiAob3B0aW9ucy5wcm9wcykge1xuICAgICAgZXh0ZW5kKHRoaXMucHJvcHMsIG9wdGlvbnMucHJvcHMpXG4gICAgfVxuXG4gICAgdGhpcy5zdG9yZSA9IG9wdGlvbnMuc3RvcmUgfHwgdGhpcy5zdG9yZTtcblxuICAgIGlmICghdGhpcy5zdG9yZSAmJiB3aW5kb3cgJiYgd2luZG93LnN0b3JlKSB7XG4gICAgICB0aGlzLnN0b3JlID0gd2luZG93LnN0b3JlXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICB0aGlzLnN0YXRlID0gZGVmYXVsdHMoe1xuICAgICAgc3RvcmVTdGF0ZTogc3RvcmVTdGF0ZVxuICAgIH0sIHRoaXMuZ2V0SW5pdGlhbFN0YXRlKCkpO1xuXG4gICAgdGhpcy5iaW5kU3RhdGVFdmVudHMoKTtcbiAgICB0aGlzLmNsZWFyQ2FjaGUoKTtcblxuICAgIGlmICghaXNEaXNwbGF5Q29tcG9uZW50KHRoaXMpKSB7XG4gICAgICB0aGlzLnRyeVN1YnNjcmliZSgpXG4gICAgfVxuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICByZXR1cm4ge31cbiAgfSxcblxuICBzZXRTdGF0ZShrZXksIHZhbCwgb3B0aW9ucykge1xuXG4gICAgaWYgKGtleSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgYm90aCBgXCJrZXlcIiwgdmFsdWVgIGFuZCBge2tleTogdmFsdWV9YCAtc3R5bGUgYXJndW1lbnRzLlxuICAgIGxldCBzdGF0ZTtcbiAgICBpZiAoaXNPYmplY3Qoa2V5KSkge1xuICAgICAgc3RhdGUgPSBrZXk7XG4gICAgICBvcHRpb25zID0gdmFsO1xuICAgIH0gZWxzZSB7XG4gICAgICAoc3RhdGUgPSB7fSlba2V5XSA9IHZhbDtcbiAgICB9XG5cbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gICAgLy8gRXh0cmFjdCBzdGF0ZSBhbmQgb3B0aW9ucy5cbiAgICBjb25zdCB1bnNldCAgICAgID0gb3B0aW9ucy51bnNldDtcbiAgICBjb25zdCBzaWxlbnQgICAgID0gb3B0aW9ucy5zaWxlbnQ7XG4gICAgY29uc3QgY2hhbmdlcyAgICA9IFtdO1xuICAgIGNvbnN0IGNoYW5naW5nICAgPSB0aGlzLl9jaGFuZ2luZztcbiAgICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7XG5cbiAgICBpZiAoIWNoYW5naW5nKSB7XG4gICAgICB0aGlzLl9wcmV2aW91c1N0YXRlID0gY2xvbmUodGhpcy5zdGF0ZSk7XG4gICAgICB0aGlzLmNoYW5nZWQgPSB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBjaGFuZ2VkID0gdGhpcy5jaGFuZ2VkO1xuICAgIGNvbnN0IHByZXYgICAgPSB0aGlzLl9wcmV2aW91c1N0YXRlO1xuXG4gICAgLy8gRm9yIGVhY2ggYHNldGAgc3RhdGUsIHVwZGF0ZSBvciBkZWxldGUgdGhlIGN1cnJlbnQgdmFsdWUuXG4gICAgZWFjaChzdGF0ZSwgZnVuY3Rpb24oX3ZhbCwgX2tleSkge1xuICAgICAgaWYgKCFpc0VxdWFsKGN1cnJlbnRbX2tleV0sIF92YWwpKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaChfa2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICghaXNFcXVhbChwcmV2W19rZXldLCBfdmFsKSkge1xuICAgICAgICBjaGFuZ2VkW19rZXldID0gX3ZhbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBjaGFuZ2VkW19rZXldO1xuICAgICAgfVxuICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFtfa2V5XSA6IGN1cnJlbnRbX2tleV0gPSBfdmFsO1xuICAgIH0pO1xuXG4gICAgLy8gVHJpZ2dlciBhbGwgcmVsZXZhbnQgc3RhdGUgY2hhbmdlcy5cbiAgICBpZiAoIXNpbGVudCkge1xuICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuX3BlbmRpbmcgPSBvcHRpb25zO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlOicgKyBjaGFuZ2VzW2ldLCB0aGlzLCBjdXJyZW50W2NoYW5nZXNbaV1dLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBZb3UgbWlnaHQgYmUgd29uZGVyaW5nIHdoeSB0aGVyZSdzIGEgYHdoaWxlYCBsb29wIGhlcmUuIENoYW5nZXMgY2FuXG4gICAgLy8gYmUgcmVjdXJzaXZlbHkgbmVzdGVkIHdpdGhpbiBgXCJjaGFuZ2VcImAgZXZlbnRzLlxuICAgIGlmIChjaGFuZ2luZykge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGlmICghc2lsZW50KSB7XG4gICAgICB3aGlsZSAodGhpcy5fcGVuZGluZykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZztcbiAgICAgICAgdGhpcy5fcGVuZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHRoaXMsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9wZW5kaW5nID0gZmFsc2U7XG4gICAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTtcbiAgICByZXR1cm4gdGhpc1xuICB9LFxuXG4gIGdldFN0YXRlKGF0dHIpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZVthdHRyXVxuICB9LFxuXG4gIGJpbmRTdGF0ZUV2ZW50cygpIHtcbiAgICBjb25zdCBiaW5kID0gYmluZEV2ZW50cyB8fCBiaW5kRW50aXR5RXZlbnRzO1xuICAgIGlmICh0aGlzLnN0YXRlRXZlbnRzKSB7XG4gICAgICBiaW5kKHRoaXMsIHRoaXMsIHRoaXMuc3RhdGVFdmVudHMpXG4gICAgfVxuICB9LFxuXG4gIHVuYmluZFN0YXRlRXZlbnRzKCkge1xuICAgIGNvbnN0IHVuYmluZCA9IHVuYmluZEV2ZW50cyB8fCB1bmJpbmRFbnRpdHlFdmVudHM7XG4gICAgaWYgKHRoaXMuc3RhdGVFdmVudHMpIHtcbiAgICAgIHVuYmluZCh0aGlzLCB0aGlzLCB0aGlzLnN0YXRlRXZlbnRzKVxuICAgIH1cbiAgfSxcblxuICBjb21wdXRlU3RhdGVQcm9wcyhzdG9yZSwgcHJvcHMpIHtcbiAgICBpZiAoIXRoaXMuZmluYWxNYXBTdGF0ZVRvUHJvcHMpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUoc3RvcmUsIHByb3BzKVxuICAgIH1cblxuICAgIGNvbnN0IHN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBjb25zdCBzdGF0ZVByb3BzID0gdGhpcy5kb1N0YXRlUHJvcHNEZXBlbmRPbk93blByb3BzID9cbiAgICAgIHRoaXMuZmluYWxNYXBTdGF0ZVRvUHJvcHMoc3RhdGUsIHByb3BzKSA6XG4gICAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKHN0YXRlKTtcblxuICAgIHJldHVybiBzdGF0ZVByb3BzXG4gIH0sXG5cbiAgY29uZmlndXJlRmluYWxNYXBTdGF0ZShzdG9yZSwgcHJvcHMpIHtcbiAgICBjb25zdCBtYXBwZWRTdGF0ZSA9IHRoaXMubWFwU3RhdGUoc3RvcmUuZ2V0U3RhdGUoKSwgcHJvcHMpO1xuICAgIGNvbnN0IGlzRmFjdG9yeSA9IGlzRnVuY3Rpb24obWFwcGVkU3RhdGUpO1xuXG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IGlzRmFjdG9yeSA/IG1hcHBlZFN0YXRlIDogdGhpcy5tYXBTdGF0ZTtcbiAgICB0aGlzLmRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMgPSB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzLmxlbmd0aCAhPT0gMTtcblxuICAgIGlmIChpc0ZhY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICByZXR1cm4gbWFwcGVkU3RhdGVcbiAgfSxcblxuICB1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQoKSB7XG4gICAgY29uc3QgbmV4dFN0YXRlUHJvcHMgPSB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHRoaXMuc3RvcmUsIHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLnN0YXRlUHJvcHMgJiYgaXNFcXVhbChuZXh0U3RhdGVQcm9wcywgdGhpcy5zdGF0ZVByb3BzKSkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZVByb3BzID0gbmV4dFN0YXRlUHJvcHM7XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9LFxuXG4gIGNvbXB1dGVEaXNwYXRjaFByb3BzKHN0b3JlLCBwcm9wcykge1xuICAgIGlmICghdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcykge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlndXJlRmluYWxNYXBEaXNwYXRjaChzdG9yZSwgcHJvcHMpXG4gICAgfVxuXG4gICAgY29uc3QgZGlzcGF0Y2ggPSBzdG9yZS5kaXNwYXRjaDtcbiAgICBjb25zdCBkaXNwYXRjaFByb3BzID0gdGhpcy5kb0Rpc3BhdGNoUHJvcHNEZXBlbmRPbk93blByb3BzID9cbiAgICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gsIHByb3BzKSA6XG4gICAgICB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzKGRpc3BhdGNoKTtcblxuICAgIHJldHVybiBkaXNwYXRjaFByb3BzXG4gIH0sXG5cbiAgY29uZmlndXJlRmluYWxNYXBEaXNwYXRjaChzdG9yZSwgcHJvcHMpIHtcbiAgICBjb25zdCBtYXBwZWREaXNwYXRjaCA9IHRoaXMubWFwRGlzcGF0Y2goc3RvcmUuZGlzcGF0Y2gsIHByb3BzKTtcbiAgICBjb25zdCBpc0ZhY3RvcnkgPSBpc0Z1bmN0aW9uKG1hcHBlZERpc3BhdGNoKTtcblxuICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMgPSBpc0ZhY3RvcnkgPyBtYXBwZWREaXNwYXRjaCA6IHRoaXMubWFwRGlzcGF0Y2g7XG4gICAgdGhpcy5kb0Rpc3BhdGNoUHJvcHNEZXBlbmRPbk93blByb3BzID0gdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcy5sZW5ndGggIT09IDE7XG5cbiAgICBpZiAoaXNGYWN0b3J5KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wdXRlRGlzcGF0Y2hQcm9wcyhzdG9yZSwgcHJvcHMpXG4gICAgfVxuXG4gICAgcmV0dXJuIG1hcHBlZERpc3BhdGNoXG4gIH0sXG5cbiAgdXBkYXRlRGlzcGF0Y2hQcm9wc0lmTmVlZGVkKCkge1xuICAgIGNvbnN0IG5leHREaXNwYXRjaFByb3BzID0gdGhpcy5jb21wdXRlRGlzcGF0Y2hQcm9wcyh0aGlzLnN0b3JlLCB0aGlzLnByb3BzKTtcbiAgICBpZiAodGhpcy5kaXNwYXRjaFByb3BzICYmIGlzRXF1YWwobmV4dERpc3BhdGNoUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcykpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMuZGlzcGF0Y2hQcm9wcyA9IG5leHREaXNwYXRjaFByb3BzO1xuXG4gICAgcmV0dXJuIHRydWVcbiAgfSxcblxuICBpc1N1YnNjcmliZWQoKSB7XG4gICAgcmV0dXJuIGlzRnVuY3Rpb24odGhpcy51bnN1YnNjcmliZSlcbiAgfSxcblxuICB0cnlTdWJzY3JpYmUoKSB7XG4gICAgaWYgKCF0aGlzLmlzU3Vic2NyaWJlZCgpKSB7XG4gICAgICB0aGlzLnVuc3Vic2NyaWJlID0gdGhpcy5zdG9yZS5zdWJzY3JpYmUodGhpcy5oYW5kbGVDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLmhhbmRsZURpc3BhdGNoUHJvcHMoKTtcbiAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKClcbiAgICB9XG4gIH0sXG5cbiAgdHJ5VW5zdWJzY3JpYmUoKSB7XG4gICAgaWYgKHRoaXMudW5zdWJzY3JpYmUpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSBudWxsXG4gICAgfVxuICB9LFxuXG4gIG9uUmVuZGVyKCkge1xuICAgIHRoaXMudHJ5U3Vic2NyaWJlKClcbiAgfSxcblxuICBvbkRlc3Ryb3koKSB7XG4gICAgdGhpcy50cnlVbnN1YnNjcmliZSgpO1xuICAgIHRoaXMudW5iaW5kU3RhdGVFdmVudHMoKTtcbiAgICB0aGlzLmNsZWFyQ2FjaGUoKVxuICB9LFxuXG4gIGNsZWFyQ2FjaGUoKSB7XG4gICAgdGhpcy5kaXNwYXRjaFByb3BzID0gbnVsbDtcbiAgICB0aGlzLnN0YXRlUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuZmluYWxNYXBTdGF0ZVRvUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQgPSBmYWxzZTtcbiAgICB0aGlzLmhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkID0gZmFsc2VcbiAgfSxcblxuICBoYW5kbGVEaXNwYXRjaFByb3BzKCkge1xuICAgIGlmICghdGhpcy5oYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCkge1xuICAgICAgdGhpcy51cGRhdGVEaXNwYXRjaFByb3BzSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuaGF2ZUluaXRpYWxEaXNwYXRjaFByb3BzQmVlbkRldGVybWluZWQgPSB0cnVlXG4gICAgfVxuICB9LFxuXG4gIGhhbmRsZUNoYW5nZSgpIHtcbiAgICBpZiAoIXRoaXMudW5zdWJzY3JpYmUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHN0b3JlU3RhdGUgPSB0aGlzLnN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgcHJldlN0b3JlU3RhdGUgPSB0aGlzLmdldFN0YXRlKCdzdG9yZVN0YXRlJyk7XG4gICAgaWYgKHRoaXMuaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQgJiYgaXNFcXVhbChwcmV2U3RvcmVTdGF0ZSwgc3RvcmVTdGF0ZSkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IGhhdmVTdGF0ZVByb3BzQ2hhbmdlZCA9IHRoaXMudXBkYXRlU3RhdGVQcm9wc0lmTmVlZGVkKCk7XG4gICAgdGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IHRydWU7XG5cbiAgICBpZiAoaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkKSB7XG5cbiAgICAgIGNvbnN0IG1lcmdlZFByb3BzID0gdGhpcy5tZXJnZVByb3BzKHRoaXMuc3RhdGVQcm9wcywgdGhpcy5kaXNwYXRjaFByb3BzLCB0aGlzLnByb3BzKTtcbiAgICAgIHRoaXMucHJvcHMgPSBtZXJnZWRQcm9wcztcblxuICAgICAgaXNGdW5jdGlvbih0aGlzLmNvbXBvbmVudERpZFJlY2VpdmVQcm9wcykgJiYgdGhpcy5jb21wb25lbnREaWRSZWNlaXZlUHJvcHMobWVyZ2VkUHJvcHMpXG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzdG9yZVN0YXRlXG4gICAgfSlcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgbWl4aW47XG4iLCJpbXBvcnQgeyBkZWZhdWx0cywgb21pdCB9IGZyb20gJ3VuZGVyc2NvcmUnO1xuaW1wb3J0IGRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMgZnJvbSAnLi9tYXBTdGF0ZVRvUHJvcHMnXG5pbXBvcnQgZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcyBmcm9tICcuL21hcERpc3BhdGNoVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWVyZ2VQcm9wcyBmcm9tICcuL21lcmdlUHJvcHMnXG5pbXBvcnQgbWl4aW4gZnJvbSAnLi9taXhpbidcbmltcG9ydCBpc0Rpc3BsYXlDb21wb25lbnQgZnJvbSAnLi9pc0Rpc3BsYXlDb21wb25lbnQnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjb25uZWN0KF9tYXBTdGF0ZVRvUHJvcHMsIF9tYXBEaXNwYXRjaFRvUHJvcHMsIF9tZXJnZVByb3BzLCBfb3B0aW9ucykge1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBfb3B0aW9ucyB8fCB7fTtcblxuICByZXR1cm4gZnVuY3Rpb24oQ29tcG9uZW50KSB7XG5cbiAgICBjb25zdCBtYXBTdGF0ZVRvUHJvcHMgPSBfbWFwU3RhdGVUb1Byb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWFwU3RhdGVUb1Byb3BzIHx8IGRlZmF1bHRNYXBTdGF0ZVRvUHJvcHM7XG4gICAgY29uc3QgbWFwRGlzcGF0Y2hUb1Byb3BzID0gX21hcERpc3BhdGNoVG9Qcm9wcyB8fCBDb21wb25lbnQucHJvdG90eXBlLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzO1xuICAgIGNvbnN0IG1lcmdlUHJvcHMgPSBfbWVyZ2VQcm9wcyB8fCBDb21wb25lbnQucHJvdG90eXBlLm1lcmdlUHJvcHMgfHwgZGVmYXVsdE1lcmdlUHJvcHM7XG4gICAgY29uc3Qgc3RvcmUgPSBvcHRpb25zLnN0b3JlIHx8IENvbXBvbmVudC5wcm90b3R5cGUuc3RvcmU7XG4gICAgY29uc3QgY29tcG9uZW50SW5pdGlhbGl6ZSA9IENvbXBvbmVudC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcbiAgICBjb25zdCBjb21wb25lbnRvblJlbmRlciA9IENvbXBvbmVudC5wcm90b3R5cGUub25SZW5kZXI7XG4gICAgY29uc3QgY29tcG9uZW50T25EZXN0cm95ID0gQ29tcG9uZW50LnByb3RvdHlwZS5vbkRlc3Ryb3k7XG5cbiAgICBsZXQgY29ubmVjdE1peGluID0gZGVmYXVsdHMoe30sIHtcblxuICAgICAgaW5pdGlhbGl6ZShfaW5pdE9wdGlvbnMpIHtcblxuICAgICAgICBjb25zdCBpbml0T3B0aW9ucyA9IF9pbml0T3B0aW9ucyB8fCB7fTtcblxuICAgICAgICBtaXhpbi5pbml0aWFsaXplLmNhbGwodGhpcywge1xuICAgICAgICAgIG1hcFN0YXRlVG9Qcm9wcyxcbiAgICAgICAgICBtYXBEaXNwYXRjaFRvUHJvcHMsXG4gICAgICAgICAgbWVyZ2VQcm9wcyxcbiAgICAgICAgICBzdG9yZSxcbiAgICAgICAgICBwcm9wczogaW5pdE9wdGlvbnMucHJvcHNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudEluaXRpYWxpemUpIHtcbiAgICAgICAgICBjb21wb25lbnRJbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIG9uUmVuZGVyKCkge1xuXG4gICAgICAgIG1peGluLm9uUmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudG9uUmVuZGVyKSB7XG4gICAgICAgICAgY29tcG9uZW50b25SZW5kZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBvbkRlc3Ryb3koKSB7XG5cbiAgICAgICAgbWl4aW4ub25EZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgaWYgKGNvbXBvbmVudE9uRGVzdHJveSkge1xuICAgICAgICAgIGNvbXBvbmVudE9uRGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgbWl4aW4pO1xuXG4gICAgaWYgKCFpc0Rpc3BsYXlDb21wb25lbnQoQ29tcG9uZW50KSkge1xuICAgICAgY29ubmVjdE1peGluID0gb21pdChjb25uZWN0TWl4aW4sICdvblJlbmRlcicpXG4gICAgfVxuXG4gICAgcmV0dXJuIENvbXBvbmVudC5leHRlbmQoY29ubmVjdE1peGluKVxuICB9XG59XG4iLCJpbXBvcnQgY29ubmVjdCBmcm9tICcuL2Nvbm5lY3QnXG5pbXBvcnQgbWl4aW4gZnJvbSAnLi9taXhpbidcbmltcG9ydCB7IHZlcnNpb24gYXMgVkVSU0lPTiB9IGZyb20gJy4uL3BhY2thZ2UuanNvbidcblxuY29uc3QgTWFyaW9uZXR0ZVJlZHV4ID0ge1xuICBjb25uZWN0LFxuICBtaXhpbixcbiAgVkVSU0lPTlxufVxuXG5leHBvcnQgZGVmYXVsdCBNYXJpb25ldHRlUmVkdXhcbiJdLCJuYW1lcyI6WyJtYXBTdGF0ZVRvUHJvcHMiLCJtYXBEaXNwYXRjaFRvUHJvcHMiLCJkaXNwYXRjaCIsIm1lcmdlUHJvcHMiLCJzdGF0ZVByb3BzIiwiZGlzcGF0Y2hQcm9wcyIsInBhcmVudFByb3BzIiwiZXh0ZW5kIiwiaXNEaXNwbGF5Q29tcG9uZW50IiwiQ29tcG9uZW50IiwiaXNGdW5jdGlvbiIsInByb3RvdHlwZSIsIlZpZXciLCJCZWhhdmlvciIsImlzT2JqZWN0IiwibWl4aW4iLCJfb3B0aW9ucyIsIm9wdGlvbnMiLCJtYXBTdGF0ZSIsImRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMiLCJtYXBEaXNwYXRjaCIsImRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHMiLCJkZWZhdWx0TWVyZ2VQcm9wcyIsInByb3BzIiwic3RvcmUiLCJ3aW5kb3ciLCJzdG9yZVN0YXRlIiwiZ2V0U3RhdGUiLCJzdGF0ZSIsImRlZmF1bHRzIiwiZ2V0SW5pdGlhbFN0YXRlIiwiYmluZFN0YXRlRXZlbnRzIiwiY2xlYXJDYWNoZSIsInRyeVN1YnNjcmliZSIsImtleSIsInZhbCIsInVuc2V0Iiwic2lsZW50IiwiY2hhbmdlcyIsImNoYW5naW5nIiwiX2NoYW5naW5nIiwiX3ByZXZpb3VzU3RhdGUiLCJjbG9uZSIsImNoYW5nZWQiLCJjdXJyZW50IiwicHJldiIsIl92YWwiLCJfa2V5IiwiaXNFcXVhbCIsInB1c2giLCJsZW5ndGgiLCJfcGVuZGluZyIsImkiLCJ0cmlnZ2VyIiwiYXR0ciIsImJpbmQiLCJiaW5kRXZlbnRzIiwiYmluZEVudGl0eUV2ZW50cyIsInN0YXRlRXZlbnRzIiwidW5iaW5kIiwidW5iaW5kRXZlbnRzIiwidW5iaW5kRW50aXR5RXZlbnRzIiwiZmluYWxNYXBTdGF0ZVRvUHJvcHMiLCJjb25maWd1cmVGaW5hbE1hcFN0YXRlIiwiZG9TdGF0ZVByb3BzRGVwZW5kT25Pd25Qcm9wcyIsIm1hcHBlZFN0YXRlIiwiaXNGYWN0b3J5IiwiY29tcHV0ZVN0YXRlUHJvcHMiLCJuZXh0U3RhdGVQcm9wcyIsImZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzIiwiY29uZmlndXJlRmluYWxNYXBEaXNwYXRjaCIsImRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMiLCJtYXBwZWREaXNwYXRjaCIsImNvbXB1dGVEaXNwYXRjaFByb3BzIiwibmV4dERpc3BhdGNoUHJvcHMiLCJ1bnN1YnNjcmliZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmliZSIsImhhbmRsZUNoYW5nZSIsImhhbmRsZURpc3BhdGNoUHJvcHMiLCJ0cnlVbnN1YnNjcmliZSIsInVuYmluZFN0YXRlRXZlbnRzIiwiaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQiLCJoYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCIsInVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCIsInByZXZTdG9yZVN0YXRlIiwiaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkIiwidXBkYXRlU3RhdGVQcm9wc0lmTmVlZGVkIiwibWVyZ2VkUHJvcHMiLCJjb21wb25lbnREaWRSZWNlaXZlUHJvcHMiLCJzZXRTdGF0ZSIsImNvbm5lY3QiLCJfbWFwU3RhdGVUb1Byb3BzIiwiX21hcERpc3BhdGNoVG9Qcm9wcyIsIl9tZXJnZVByb3BzIiwiY29tcG9uZW50SW5pdGlhbGl6ZSIsImluaXRpYWxpemUiLCJjb21wb25lbnRvblJlbmRlciIsIm9uUmVuZGVyIiwiY29tcG9uZW50T25EZXN0cm95Iiwib25EZXN0cm95IiwiY29ubmVjdE1peGluIiwiX2luaXRPcHRpb25zIiwiaW5pdE9wdGlvbnMiLCJjYWxsIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJvbWl0IiwiTWFyaW9uZXR0ZVJlZHV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFlLFNBQVNBLGVBQVQsR0FBMkI7U0FDakMsRUFBUDs7O0FDRGEsU0FBU0Msa0JBQVQsQ0FBNEJDLFFBQTVCLEVBQXNDO1NBQzVDO2NBQ0tBO0dBRFo7OztBQ0FhLFNBQVNDLFVBQVQsQ0FBb0JDLFVBQXBCLEVBQWdDQyxhQUFoQyxFQUErQ0MsV0FBL0MsRUFBNEQ7U0FDbEVDLGtCQUFPLEVBQVAsRUFBV0QsV0FBWCxFQUF3QkYsVUFBeEIsRUFBb0NDLGFBQXBDLENBQVA7OztBQ0NhLFNBQVNHLGtCQUFULENBQTRCQyxTQUE1QixFQUF1QztNQUNoREMsc0JBQVdELFNBQVgsQ0FBSixFQUEyQjtXQUNsQkEsVUFBVUUsU0FBVixZQUErQkMsZUFBL0IsSUFBdUNILFVBQVVFLFNBQVYsWUFBK0JFLG1CQUE3RTs7TUFFRUMsb0JBQVNMLFNBQVQsQ0FBSixFQUF5QjtXQUNoQkEscUJBQXFCRyxlQUFyQixJQUE2QkgscUJBQXFCSSxtQkFBekQ7O1NBRUssS0FBUDs7O0FDVUYsSUFBTUUsUUFBUTtZQUFBLHNCQUVEQyxRQUZDLEVBRVM7O1FBRWJDLFVBQVVELFlBQVksRUFBNUI7O1NBRUtFLFFBQUwsR0FBZ0JELFFBQVFqQixlQUFSLElBQTJCLEtBQUtBLGVBQWhDLElBQW1EbUIsZUFBbkU7U0FDS0MsV0FBTCxHQUFtQkgsUUFBUWhCLGtCQUFSLElBQThCLEtBQUtBLGtCQUFuQyxJQUF5RG9CLGtCQUE1RTtTQUNLbEIsVUFBTCxHQUFrQmMsUUFBUWQsVUFB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