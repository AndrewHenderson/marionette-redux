// Marionette Redux
// ----------------------------------
// v0.1.1
//
// Copyright (c)2016 Andrew Henderson.
// Distributed under MIT license


(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('underscore'), require('marionette')) :
  typeof define === 'function' && define.amd ? define(['exports', 'underscore', 'marionette'], factory) :
  (factory((global.MarionetteRedux = global.MarionetteRedux || {}),global._,global.Marionette));
}(this, (function (exports,_,Marionette) { 'use strict';

_ = 'default' in _ ? _['default'] : _;
Marionette = 'default' in Marionette ? Marionette['default'] : Marionette;

var defaultMapStateToProps = (function (state) {
  return {};
});

var defaultMapDispatchToProps = (function (dispatch) {
  return { dispatch: dispatch };
});

var defaultMergeProps = (function (stateProps, dispatchProps, parentProps) {
  return _.extend({}, parentProps, stateProps, dispatchProps);
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var setState = function (key, val, options) {

  if (key == null) {
    return this;
  }

  // Handle both `"key", value` and `{key: value}` -style arguments.
  var state = void 0;
  if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
    state = key;
    options = val;
  } else {
    (state = {})[key] = val;
  }

  options || (options = {});

  // Extract state and options.
  var unset = options.unset;
  var silent = options.silent;
  var changes = [];
  var changing = this._changing;
  this._changing = true;

  if (!changing) {
    this._previousState = _.clone(this.state);
    this.changed = {};
  }

  var current = this.state;
  var changed = this.changed;
  var prev = this._previousState;

  // For each `set` state, update or delete the current value.
  _.each(state, function (_val, _key) {
    if (!_.isEqual(current[_key], _val)) {
      changes.push(_key);
    }
    if (!_.isEqual(prev[_key], _val)) {
      changed[_key] = _val;
    } else {
      delete changed[_key];
    }
    unset ? delete current[_key] : current[_key] = _val;
  });

  // Trigger all relevant state changes.
  if (!silent) {
    if (changes.length) {
      this._pending = options;
    }
    for (var i = 0; i < changes.length; i++) {
      this.trigger('change:' + changes[i], this, current[changes[i]], options);
    }
  }

  // You might be wondering why there's a `while` loop here. Changes can
  // be recursively nested within `"change"` events.
  if (changing) {
    return this;
  }
  if (!silent) {
    while (this._pending) {
      options = this._pending;
      this._pending = false;
      this.trigger('change', this, options);
    }
  }
  this._pending = false;
  this._changing = false;
  return this;
};

var getState = function (attr) {
  return this.state[attr];
};

var _typeof$1 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var isDisplayComponent = function (Component) {
  if ((typeof Component === 'undefined' ? 'undefined' : _typeof$1(Component)) === 'object') {
    return Component instanceof Marionette.View || Component instanceof Marionette.Behavior;
  }
  if (typeof Component === 'function') {
    return Component.prototype instanceof Marionette.View || Component.prototype instanceof Marionette.Behavior;
  }
  return false;
};

var mixin = {
  initialize: function initialize(_options) {

    var options = _options || {};

    this.mapState = options.mapStateToProps || this.mapStateToProps || defaultMapStateToProps;
    this.mapDispatch = options.mapDispatchToProps || this.mapDispatchToProps || defaultMapDispatchToProps;
    this.mergeProps = options.mergeProps || this.mergeProps || defaultMergeProps;
    this.props = this.props || {};

    if (options.props) {
      _.extend(this.props, options.props);
    }

    this.store = options.store || this.store;

    if (!this.store && window && window.store) {
      this.store = window.store;
    }

    var storeState = this.store.getState();
    this.state = _.defaults({
      storeState: storeState
    }, this.getInitialState());

    this.bindStateEvents();
    this.clearCache();

    if (!isDisplayComponent(this)) {
      this.trySubscribe();
    }
  },
  getInitialState: function getInitialState() {
    return {};
  },


  setState: setState,

  getState: getState,

  bindStateEvents: function bindStateEvents() {
    var bind = void 0;
    if (this.stateEvents) {
      bind = Marionette.bindEvents || Marionette.bindEntityEvents;
      bind(this, this, this.stateEvents);
    }
  },
  unbindStateEvents: function unbindStateEvents() {
    var unbind = void 0;
    if (this.stateEvents) {
      unbind = Marionette.unbindEvents || Marionette.unbindEntityEvents;
      unbind(this, this, this.stateEvents);
    }
  },
  computeStateProps: function computeStateProps(store, props) {
    if (!this.finalMapStateToProps) {
      return this.configureFinalMapState(store, props);
    }

    var state = store.getState();
    var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

    return stateProps;
  },
  configureFinalMapState: function configureFinalMapState(store, props) {
    var mappedState = this.mapState(store.getState(), props);
    var isFactory = _.isFunction(mappedState);

    this.finalMapStateToProps = isFactory ? mappedState : this.mapState;
    this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

    if (isFactory) {
      return this.computeStateProps(store, props);
    }

    return mappedState;
  },
  updateStatePropsIfNeeded: function updateStatePropsIfNeeded() {
    var nextStateProps = this.computeStateProps(this.store, this.props);
    if (this.stateProps && _.isEqual(nextStateProps, this.stateProps)) {
      return false;
    }

    this.stateProps = nextStateProps;

    return true;
  },
  computeDispatchProps: function computeDispatchProps(store, props) {
    if (!this.finalMapDispatchToProps) {
      return this.configureFinalMapDispatch(store, props);
    }

    var dispatch = store.dispatch;
    var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

    return dispatchProps;
  },
  configureFinalMapDispatch: function configureFinalMapDispatch(store, props) {
    var mappedDispatch = this.mapDispatch(store.dispatch, props);
    var isFactory = _.isFunction(mappedDispatch);

    this.finalMapDispatchToProps = isFactory ? mappedDispatch : this.mapDispatch;
    this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

    if (isFactory) {
      return this.computeDispatchProps(store, props);
    }

    return mappedDispatch;
  },
  updateDispatchPropsIfNeeded: function updateDispatchPropsIfNeeded() {
    var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
    if (this.dispatchProps && _.isEqual(nextDispatchProps, this.dispatchProps)) {
      return false;
    }

    this.dispatchProps = nextDispatchProps;

    return true;
  },
  isSubscribed: function isSubscribed() {
    return _.isFunction(this.unsubscribe);
  },
  trySubscribe: function trySubscribe() {
    if (!this.isSubscribed()) {
      this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
      this.handleDispatchProps();
      this.handleChange();
    }
  },
  tryUnsubscribe: function tryUnsubscribe() {
    if (this.unsubscribe) {
      this.unsubscribe();
      this.unsubscribe = null;
    }
  },
  onRender: function onRender() {
    this.trySubscribe();
  },
  onDestroy: function onDestroy() {
    this.tryUnsubscribe();
    this.unbindStateEvents();
    this.clearCache();
  },
  clearCache: function clearCache() {
    this.dispatchProps = null;
    this.stateProps = null;
    this.finalMapDispatchToProps = null;
    this.finalMapStateToProps = null;
    this.haveInitialStatePropsBeenDetermined = false;
    this.haveInitialDispatchPropsBeenDetermined = false;
  },
  handleDispatchProps: function handleDispatchProps() {
    if (!this.haveInitialDispatchPropsBeenDetermined) {
      this.updateDispatchPropsIfNeeded();
      this.haveInitialDispatchPropsBeenDetermined = true;
    }
  },
  handleChange: function handleChange() {
    if (!this.unsubscribe) {
      return;
    }

    var storeState = this.store.getState();
    var prevStoreState = this.getState('storeState');
    if (this.haveInitialStatePropsBeenDetermined && _.isEqual(prevStoreState, storeState)) {
      return;
    }

    var haveStatePropsChanged = this.updateStatePropsIfNeeded();
    this.haveInitialStatePropsBeenDetermined = true;

    if (haveStatePropsChanged) {

      var mergedProps = this.mergeProps(this.stateProps, this.dispatchProps, this.props);
      this.props = mergedProps;

      _.isFunction(this.componentDidReceiveProps) && this.componentDidReceiveProps(mergedProps);
    }

    this.setState({
      storeState: storeState
    });
  }
};

var connect = (function (_mapStateToProps, _mapDispatchToProps, _mergeProps, _options) {

  var options = _options || {};

  return function (Component) {

    var mapStateToProps = _mapStateToProps || Component.prototype.mapStateToProps || defaultMapStateToProps;
    var mapDispatchToProps = _mapDispatchToProps || Component.prototype.mapDispatchToProps || defaultMapDispatchToProps;
    var mergeProps = _mergeProps || Component.prototype.mergeProps || defaultMergeProps;
    var store = options.store || Component.prototype.store;
    var componentInitialize = Component.prototype.initialize;
    var componentonRender = Component.prototype.onRender;
    var componentOnDestroy = Component.prototype.onDestroy;

    var connectMixin = _.defaults({}, {
      initialize: function initialize(_initOptions) {

        var initOptions = _initOptions || {};

        mixin.initialize.call(this, {
          mapStateToProps: mapStateToProps,
          mapDispatchToProps: mapDispatchToProps,
          mergeProps: mergeProps,
          store: store,
          props: initOptions.props
        });

        if (componentInitialize) {
          componentInitialize.apply(this, arguments);
        }
      },
      onRender: function onRender() {

        mixin.onRender.apply(this, arguments);

        if (componentonRender) {
          componentonRender.apply(this, arguments);
        }
      },
      onDestroy: function onDestroy() {

        mixin.onDestroy.apply(this, arguments);

        if (componentOnDestroy) {
          componentOnDestroy.apply(this, arguments);
        }
      }
    }, mixin);

    if (!isDisplayComponent(Component)) {
      connectMixin = _.omit(connectMixin, 'onRender');
    }

    return Component.extend(connectMixin);
  };
});

exports.connect = connect;
exports.mixin = mixin;

Object.defineProperty(exports, '__esModule', { value: true });

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvbWFwU3RhdGVUb1Byb3BzLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9tYXBEaXNwYXRjaFRvUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL21lcmdlUHJvcHMuanMiLCIvVXNlcnMvYW5kcmV3aGVuZGVyc29uL21hcmlvbmV0dGUtcmVkdXgvc3JjL3NldFN0YXRlLmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9nZXRTdGF0ZS5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvaXNEaXNwbGF5Q29tcG9uZW50LmpzIiwiL1VzZXJzL2FuZHJld2hlbmRlcnNvbi9tYXJpb25ldHRlLXJlZHV4L3NyYy9taXhpbi5qcyIsIi9Vc2Vycy9hbmRyZXdoZW5kZXJzb24vbWFyaW9uZXR0ZS1yZWR1eC9zcmMvY29ubmVjdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBzdGF0ZSA9PiAoe30pXG4iLCJleHBvcnQgZGVmYXVsdCBkaXNwYXRjaCA9PiAoeyBkaXNwYXRjaCB9KVxuIiwiaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7XG5leHBvcnQgZGVmYXVsdCAoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgcGFyZW50UHJvcHMpID0+IChcbiAgXy5leHRlbmQoe30sIHBhcmVudFByb3BzLCBzdGF0ZVByb3BzLCBkaXNwYXRjaFByb3BzKVxuKVxuIiwiaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7XG5cbiAgaWYgKGtleSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyBIYW5kbGUgYm90aCBgXCJrZXlcIiwgdmFsdWVgIGFuZCBge2tleTogdmFsdWV9YCAtc3R5bGUgYXJndW1lbnRzLlxuICBsZXQgc3RhdGU7XG4gIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgIHN0YXRlID0ga2V5O1xuICAgIG9wdGlvbnMgPSB2YWw7XG4gIH0gZWxzZSB7XG4gICAgKHN0YXRlID0ge30pW2tleV0gPSB2YWw7XG4gIH1cblxuICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gIC8vIEV4dHJhY3Qgc3RhdGUgYW5kIG9wdGlvbnMuXG4gIGNvbnN0IHVuc2V0ICAgICAgPSBvcHRpb25zLnVuc2V0O1xuICBjb25zdCBzaWxlbnQgICAgID0gb3B0aW9ucy5zaWxlbnQ7XG4gIGNvbnN0IGNoYW5nZXMgICAgPSBbXTtcbiAgY29uc3QgY2hhbmdpbmcgICA9IHRoaXMuX2NoYW5naW5nO1xuICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7XG5cbiAgaWYgKCFjaGFuZ2luZykge1xuICAgIHRoaXMuX3ByZXZpb3VzU3RhdGUgPSBfLmNsb25lKHRoaXMuc3RhdGUpO1xuICAgIHRoaXMuY2hhbmdlZCA9IHt9O1xuICB9XG5cbiAgY29uc3QgY3VycmVudCA9IHRoaXMuc3RhdGU7XG4gIGNvbnN0IGNoYW5nZWQgPSB0aGlzLmNoYW5nZWQ7XG4gIGNvbnN0IHByZXYgICAgPSB0aGlzLl9wcmV2aW91c1N0YXRlO1xuXG4gIC8vIEZvciBlYWNoIGBzZXRgIHN0YXRlLCB1cGRhdGUgb3IgZGVsZXRlIHRoZSBjdXJyZW50IHZhbHVlLlxuICBfLmVhY2goc3RhdGUsIGZ1bmN0aW9uKF92YWwsIF9rZXkpIHtcbiAgICBpZiAoIV8uaXNFcXVhbChjdXJyZW50W19rZXldLCBfdmFsKSkge1xuICAgICAgY2hhbmdlcy5wdXNoKF9rZXkpO1xuICAgIH1cbiAgICBpZiAoIV8uaXNFcXVhbChwcmV2W19rZXldLCBfdmFsKSkge1xuICAgICAgY2hhbmdlZFtfa2V5XSA9IF92YWw7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSBjaGFuZ2VkW19rZXldO1xuICAgIH1cbiAgICB1bnNldCA/IGRlbGV0ZSBjdXJyZW50W19rZXldIDogY3VycmVudFtfa2V5XSA9IF92YWw7XG4gIH0pO1xuXG4gIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IHN0YXRlIGNoYW5nZXMuXG4gIGlmICghc2lsZW50KSB7XG4gICAgaWYgKGNoYW5nZXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9wZW5kaW5nID0gb3B0aW9ucztcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTonICsgY2hhbmdlc1tpXSwgdGhpcywgY3VycmVudFtjaGFuZ2VzW2ldXSwgb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgLy8gWW91IG1pZ2h0IGJlIHdvbmRlcmluZyB3aHkgdGhlcmUncyBhIGB3aGlsZWAgbG9vcCBoZXJlLiBDaGFuZ2VzIGNhblxuICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGBcImNoYW5nZVwiYCBldmVudHMuXG4gIGlmIChjaGFuZ2luZykge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGlmICghc2lsZW50KSB7XG4gICAgd2hpbGUgKHRoaXMuX3BlbmRpbmcpIHtcbiAgICAgIG9wdGlvbnMgPSB0aGlzLl9wZW5kaW5nO1xuICAgICAgdGhpcy5fcGVuZGluZyA9IGZhbHNlO1xuICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2UnLCB0aGlzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cbiAgdGhpcy5fcGVuZGluZyA9IGZhbHNlO1xuICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlO1xuICByZXR1cm4gdGhpc1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oYXR0cikge1xuICByZXR1cm4gdGhpcy5zdGF0ZVthdHRyXTtcbn1cbiIsImltcG9ydCBNYXJpb25ldHRlIGZyb20gJ21hcmlvbmV0dGUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKENvbXBvbmVudCkge1xuICBpZiAodHlwZW9mIENvbXBvbmVudCA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gQ29tcG9uZW50IGluc3RhbmNlb2YgTWFyaW9uZXR0ZS5WaWV3IHx8IENvbXBvbmVudCBpbnN0YW5jZW9mIE1hcmlvbmV0dGUuQmVoYXZpb3JcbiAgfVxuICBpZiAodHlwZW9mIENvbXBvbmVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBDb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgTWFyaW9uZXR0ZS5WaWV3IHx8IENvbXBvbmVudC5wcm90b3R5cGUgaW5zdGFuY2VvZiBNYXJpb25ldHRlLkJlaGF2aW9yXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG4iLCJpbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmltcG9ydCBNYXJpb25ldHRlIGZyb20gJ21hcmlvbmV0dGUnXG5pbXBvcnQgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcyBmcm9tICcuL21hcFN0YXRlVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzIGZyb20gJy4vbWFwRGlzcGF0Y2hUb1Byb3BzJ1xuaW1wb3J0IGRlZmF1bHRNZXJnZVByb3BzIGZyb20gJy4vbWVyZ2VQcm9wcydcbmltcG9ydCBzZXRTdGF0ZSBmcm9tICcuL3NldFN0YXRlJ1xuaW1wb3J0IGdldFN0YXRlIGZyb20gJy4vZ2V0U3RhdGUnXG5pbXBvcnQgaXNEaXNwbGF5Q29tcG9uZW50IGZyb20gJy4vaXNEaXNwbGF5Q29tcG9uZW50JztcblxuZXhwb3J0IGRlZmF1bHQge1xuXG4gIGluaXRpYWxpemUoX29wdGlvbnMpIHtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBfb3B0aW9ucyB8fCB7fTtcblxuICAgIHRoaXMubWFwU3RhdGUgPSBvcHRpb25zLm1hcFN0YXRlVG9Qcm9wcyB8fCB0aGlzLm1hcFN0YXRlVG9Qcm9wcyB8fCBkZWZhdWx0TWFwU3RhdGVUb1Byb3BzO1xuICAgIHRoaXMubWFwRGlzcGF0Y2ggPSBvcHRpb25zLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCB0aGlzLm1hcERpc3BhdGNoVG9Qcm9wcyB8fCBkZWZhdWx0TWFwRGlzcGF0Y2hUb1Byb3BzO1xuICAgIHRoaXMubWVyZ2VQcm9wcyA9IG9wdGlvbnMubWVyZ2VQcm9wcyB8fCB0aGlzLm1lcmdlUHJvcHMgfHwgZGVmYXVsdE1lcmdlUHJvcHM7XG4gICAgdGhpcy5wcm9wcyA9IHRoaXMucHJvcHMgfHwge307XG5cbiAgICBpZiAob3B0aW9ucy5wcm9wcykge1xuICAgICAgXy5leHRlbmQodGhpcy5wcm9wcywgb3B0aW9ucy5wcm9wcylcbiAgICB9XG5cbiAgICB0aGlzLnN0b3JlID0gb3B0aW9ucy5zdG9yZSB8fCB0aGlzLnN0b3JlO1xuXG4gICAgaWYgKCF0aGlzLnN0b3JlICYmIHdpbmRvdyAmJiB3aW5kb3cuc3RvcmUpIHtcbiAgICAgIHRoaXMuc3RvcmUgPSB3aW5kb3cuc3RvcmVcbiAgICB9XG5cbiAgICBjb25zdCBzdG9yZVN0YXRlID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpO1xuICAgIHRoaXMuc3RhdGUgPSBfLmRlZmF1bHRzKHtcbiAgICAgIHN0b3JlU3RhdGU6IHN0b3JlU3RhdGVcbiAgICB9LCB0aGlzLmdldEluaXRpYWxTdGF0ZSgpKTtcblxuICAgIHRoaXMuYmluZFN0YXRlRXZlbnRzKCk7XG4gICAgdGhpcy5jbGVhckNhY2hlKCk7XG5cbiAgICBpZiAoIWlzRGlzcGxheUNvbXBvbmVudCh0aGlzKSkge1xuICAgICAgdGhpcy50cnlTdWJzY3JpYmUoKVxuICAgIH1cbiAgfSxcblxuICBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgcmV0dXJuIHt9XG4gIH0sXG5cbiAgc2V0U3RhdGUsXG5cbiAgZ2V0U3RhdGUsXG5cbiAgYmluZFN0YXRlRXZlbnRzKCkge1xuICAgIGxldCBiaW5kO1xuICAgIGlmICh0aGlzLnN0YXRlRXZlbnRzKSB7XG4gICAgICBiaW5kID0gTWFyaW9uZXR0ZS5iaW5kRXZlbnRzIHx8IE1hcmlvbmV0dGUuYmluZEVudGl0eUV2ZW50cztcbiAgICAgIGJpbmQodGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgdW5iaW5kU3RhdGVFdmVudHMoKSB7XG4gICAgbGV0IHVuYmluZDtcbiAgICBpZiAodGhpcy5zdGF0ZUV2ZW50cykge1xuICAgICAgdW5iaW5kID0gTWFyaW9uZXR0ZS51bmJpbmRFdmVudHMgfHwgTWFyaW9uZXR0ZS51bmJpbmRFbnRpdHlFdmVudHM7XG4gICAgICB1bmJpbmQodGhpcywgdGhpcywgdGhpcy5zdGF0ZUV2ZW50cylcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZVN0YXRlUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcFN0YXRlKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3Qgc3RhdGVQcm9wcyA9IHRoaXMuZG9TdGF0ZVByb3BzRGVwZW5kT25Pd25Qcm9wcyA/XG4gICAgICB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzKHN0YXRlLCBwcm9wcykgOlxuICAgICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSk7XG5cbiAgICByZXR1cm4gc3RhdGVQcm9wc1xuICB9LFxuXG4gIGNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUoc3RvcmUsIHByb3BzKSB7XG4gICAgY29uc3QgbWFwcGVkU3RhdGUgPSB0aGlzLm1hcFN0YXRlKHN0b3JlLmdldFN0YXRlKCksIHByb3BzKTtcbiAgICBjb25zdCBpc0ZhY3RvcnkgPSBfLmlzRnVuY3Rpb24obWFwcGVkU3RhdGUpO1xuXG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IGlzRmFjdG9yeSA/IG1hcHBlZFN0YXRlIDogdGhpcy5tYXBTdGF0ZTtcbiAgICB0aGlzLmRvU3RhdGVQcm9wc0RlcGVuZE9uT3duUHJvcHMgPSB0aGlzLmZpbmFsTWFwU3RhdGVUb1Byb3BzLmxlbmd0aCAhPT0gMTtcblxuICAgIGlmIChpc0ZhY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICByZXR1cm4gbWFwcGVkU3RhdGVcbiAgfSxcblxuICB1cGRhdGVTdGF0ZVByb3BzSWZOZWVkZWQoKSB7XG4gICAgY29uc3QgbmV4dFN0YXRlUHJvcHMgPSB0aGlzLmNvbXB1dGVTdGF0ZVByb3BzKHRoaXMuc3RvcmUsIHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLnN0YXRlUHJvcHMgJiYgXy5pc0VxdWFsKG5leHRTdGF0ZVByb3BzLCB0aGlzLnN0YXRlUHJvcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlUHJvcHMgPSBuZXh0U3RhdGVQcm9wcztcblxuICAgIHJldHVybiB0cnVlXG4gIH0sXG5cbiAgY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKSB7XG4gICAgaWYgKCF0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcylcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwYXRjaCA9IHN0b3JlLmRpc3BhdGNoO1xuICAgIGNvbnN0IGRpc3BhdGNoUHJvcHMgPSB0aGlzLmRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMgP1xuICAgICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCwgcHJvcHMpIDpcbiAgICAgIHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpO1xuXG4gICAgcmV0dXJuIGRpc3BhdGNoUHJvcHNcbiAgfSxcblxuICBjb25maWd1cmVGaW5hbE1hcERpc3BhdGNoKHN0b3JlLCBwcm9wcykge1xuICAgIGNvbnN0IG1hcHBlZERpc3BhdGNoID0gdGhpcy5tYXBEaXNwYXRjaChzdG9yZS5kaXNwYXRjaCwgcHJvcHMpO1xuICAgIGNvbnN0IGlzRmFjdG9yeSA9IF8uaXNGdW5jdGlvbihtYXBwZWREaXNwYXRjaCk7XG5cbiAgICB0aGlzLmZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzID0gaXNGYWN0b3J5ID8gbWFwcGVkRGlzcGF0Y2ggOiB0aGlzLm1hcERpc3BhdGNoO1xuICAgIHRoaXMuZG9EaXNwYXRjaFByb3BzRGVwZW5kT25Pd25Qcm9wcyA9IHRoaXMuZmluYWxNYXBEaXNwYXRjaFRvUHJvcHMubGVuZ3RoICE9PSAxO1xuXG4gICAgaWYgKGlzRmFjdG9yeSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHMoc3RvcmUsIHByb3BzKVxuICAgIH1cblxuICAgIHJldHVybiBtYXBwZWREaXNwYXRjaFxuICB9LFxuXG4gIHVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpIHtcbiAgICBjb25zdCBuZXh0RGlzcGF0Y2hQcm9wcyA9IHRoaXMuY29tcHV0ZURpc3BhdGNoUHJvcHModGhpcy5zdG9yZSwgdGhpcy5wcm9wcyk7XG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hQcm9wcyAmJiBfLmlzRXF1YWwobmV4dERpc3BhdGNoUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcykpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMuZGlzcGF0Y2hQcm9wcyA9IG5leHREaXNwYXRjaFByb3BzO1xuXG4gICAgcmV0dXJuIHRydWVcbiAgfSxcblxuICBpc1N1YnNjcmliZWQoKSB7XG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbih0aGlzLnVuc3Vic2NyaWJlKVxuICB9LFxuXG4gIHRyeVN1YnNjcmliZSgpIHtcbiAgICBpZiAoIXRoaXMuaXNTdWJzY3JpYmVkKCkpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSB0aGlzLnN0b3JlLnN1YnNjcmliZSh0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuaGFuZGxlRGlzcGF0Y2hQcm9wcygpO1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoKVxuICAgIH1cbiAgfSxcblxuICB0cnlVbnN1YnNjcmliZSgpIHtcbiAgICBpZiAodGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgb25SZW5kZXIoKSB7XG4gICAgdGhpcy50cnlTdWJzY3JpYmUoKVxuICB9LFxuXG4gIG9uRGVzdHJveSgpIHtcbiAgICB0aGlzLnRyeVVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy51bmJpbmRTdGF0ZUV2ZW50cygpO1xuICAgIHRoaXMuY2xlYXJDYWNoZSgpXG4gIH0sXG5cbiAgY2xlYXJDYWNoZSgpIHtcbiAgICB0aGlzLmRpc3BhdGNoUHJvcHMgPSBudWxsO1xuICAgIHRoaXMuc3RhdGVQcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcERpc3BhdGNoVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5maW5hbE1hcFN0YXRlVG9Qcm9wcyA9IG51bGw7XG4gICAgdGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IGZhbHNlO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxEaXNwYXRjaFByb3BzQmVlbkRldGVybWluZWQgPSBmYWxzZVxuICB9LFxuXG4gIGhhbmRsZURpc3BhdGNoUHJvcHMoKSB7XG4gICAgaWYgKCF0aGlzLmhhdmVJbml0aWFsRGlzcGF0Y2hQcm9wc0JlZW5EZXRlcm1pbmVkKSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5oYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCA9IHRydWVcbiAgICB9XG4gIH0sXG5cbiAgaGFuZGxlQ2hhbmdlKCkge1xuICAgIGlmICghdGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmVTdGF0ZSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBjb25zdCBwcmV2U3RvcmVTdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoJ3N0b3JlU3RhdGUnKTtcbiAgICBpZiAodGhpcy5oYXZlSW5pdGlhbFN0YXRlUHJvcHNCZWVuRGV0ZXJtaW5lZCAmJiBfLmlzRXF1YWwocHJldlN0b3JlU3RhdGUsIHN0b3JlU3RhdGUpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBoYXZlU3RhdGVQcm9wc0NoYW5nZWQgPSB0aGlzLnVwZGF0ZVN0YXRlUHJvcHNJZk5lZWRlZCgpO1xuICAgIHRoaXMuaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQgPSB0cnVlO1xuXG4gICAgaWYgKGhhdmVTdGF0ZVByb3BzQ2hhbmdlZCkge1xuXG4gICAgICBjb25zdCBtZXJnZWRQcm9wcyA9IHRoaXMubWVyZ2VQcm9wcyh0aGlzLnN0YXRlUHJvcHMsIHRoaXMuZGlzcGF0Y2hQcm9wcywgdGhpcy5wcm9wcyk7XG4gICAgICB0aGlzLnByb3BzID0gbWVyZ2VkUHJvcHM7XG5cbiAgICAgIF8uaXNGdW5jdGlvbih0aGlzLmNvbXBvbmVudERpZFJlY2VpdmVQcm9wcykgJiYgdGhpcy5jb21wb25lbnREaWRSZWNlaXZlUHJvcHMobWVyZ2VkUHJvcHMpXG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzdG9yZVN0YXRlXG4gICAgfSlcbiAgfVxufTtcbiIsImltcG9ydCBfIGZyb20gJ3VuZGVyc2NvcmUnO1xuaW1wb3J0IGRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMgZnJvbSAnLi9tYXBTdGF0ZVRvUHJvcHMnXG5pbXBvcnQgZGVmYXVsdE1hcERpc3BhdGNoVG9Qcm9wcyBmcm9tICcuL21hcERpc3BhdGNoVG9Qcm9wcydcbmltcG9ydCBkZWZhdWx0TWVyZ2VQcm9wcyBmcm9tICcuL21lcmdlUHJvcHMnXG5pbXBvcnQgbWl4aW4gZnJvbSAnLi9taXhpbidcbmltcG9ydCBpc0Rpc3BsYXlDb21wb25lbnQgZnJvbSAnLi9pc0Rpc3BsYXlDb21wb25lbnQnO1xuXG5leHBvcnQgZGVmYXVsdCAoX21hcFN0YXRlVG9Qcm9wcywgX21hcERpc3BhdGNoVG9Qcm9wcywgX21lcmdlUHJvcHMsIF9vcHRpb25zKSA9PiB7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IF9vcHRpb25zIHx8IHt9O1xuXG4gIHJldHVybiBmdW5jdGlvbihDb21wb25lbnQpIHtcblxuICAgIGNvbnN0IG1hcFN0YXRlVG9Qcm9wcyA9IF9tYXBTdGF0ZVRvUHJvcHMgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5tYXBTdGF0ZVRvUHJvcHMgfHwgZGVmYXVsdE1hcFN0YXRlVG9Qcm9wcztcbiAgICBjb25zdCBtYXBEaXNwYXRjaFRvUHJvcHMgPSBfbWFwRGlzcGF0Y2hUb1Byb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWFwRGlzcGF0Y2hUb1Byb3BzIHx8IGRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHM7XG4gICAgY29uc3QgbWVyZ2VQcm9wcyA9IF9tZXJnZVByb3BzIHx8IENvbXBvbmVudC5wcm90b3R5cGUubWVyZ2VQcm9wcyB8fCBkZWZhdWx0TWVyZ2VQcm9wcztcbiAgICBjb25zdCBzdG9yZSA9IG9wdGlvbnMuc3RvcmUgfHwgQ29tcG9uZW50LnByb3RvdHlwZS5zdG9yZTtcbiAgICBjb25zdCBjb21wb25lbnRJbml0aWFsaXplID0gQ29tcG9uZW50LnByb3RvdHlwZS5pbml0aWFsaXplO1xuICAgIGNvbnN0IGNvbXBvbmVudG9uUmVuZGVyID0gQ29tcG9uZW50LnByb3RvdHlwZS5vblJlbmRlcjtcbiAgICBjb25zdCBjb21wb25lbnRPbkRlc3Ryb3kgPSBDb21wb25lbnQucHJvdG90eXBlLm9uRGVzdHJveTtcblxuICAgIGxldCBjb25uZWN0TWl4aW4gPSBfLmRlZmF1bHRzKHt9LCB7XG5cbiAgICAgIGluaXRpYWxpemUoX2luaXRPcHRpb25zKSB7XG5cbiAgICAgICAgY29uc3QgaW5pdE9wdGlvbnMgPSBfaW5pdE9wdGlvbnMgfHwge307XG5cbiAgICAgICAgbWl4aW4uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHtcbiAgICAgICAgICBtYXBTdGF0ZVRvUHJvcHMsXG4gICAgICAgICAgbWFwRGlzcGF0Y2hUb1Byb3BzLFxuICAgICAgICAgIG1lcmdlUHJvcHMsXG4gICAgICAgICAgc3RvcmUsXG4gICAgICAgICAgcHJvcHM6IGluaXRPcHRpb25zLnByb3BzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjb21wb25lbnRJbml0aWFsaXplKSB7XG4gICAgICAgICAgY29tcG9uZW50SW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBvblJlbmRlcigpIHtcblxuICAgICAgICBtaXhpbi5vblJlbmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgICAgIGlmIChjb21wb25lbnRvblJlbmRlcikge1xuICAgICAgICAgIGNvbXBvbmVudG9uUmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgb25EZXN0cm95KCkge1xuXG4gICAgICAgIG1peGluLm9uRGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgICAgIGlmIChjb21wb25lbnRPbkRlc3Ryb3kpIHtcbiAgICAgICAgICBjb21wb25lbnRPbkRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIG1peGluKTtcblxuICAgIGlmICghaXNEaXNwbGF5Q29tcG9uZW50KENvbXBvbmVudCkpIHtcbiAgICAgIGNvbm5lY3RNaXhpbiA9IF8ub21pdChjb25uZWN0TWl4aW4sICdvblJlbmRlcicpXG4gICAgfVxuXG4gICAgcmV0dXJuIENvbXBvbmVudC5leHRlbmQoY29ubmVjdE1peGluKVxuICB9XG59XG4iXSwibmFtZXMiOlsiZGlzcGF0Y2giLCJzdGF0ZVByb3BzIiwiZGlzcGF0Y2hQcm9wcyIsInBhcmVudFByb3BzIiwiXyIsImV4dGVuZCIsImtleSIsInZhbCIsIm9wdGlvbnMiLCJzdGF0ZSIsInVuc2V0Iiwic2lsZW50IiwiY2hhbmdlcyIsImNoYW5naW5nIiwiX2NoYW5naW5nIiwiX3ByZXZpb3VzU3RhdGUiLCJjbG9uZSIsImNoYW5nZWQiLCJjdXJyZW50IiwicHJldiIsImVhY2giLCJfdmFsIiwiX2tleSIsImlzRXF1YWwiLCJwdXNoIiwibGVuZ3RoIiwiX3BlbmRpbmciLCJpIiwidHJpZ2dlciIsImF0dHIiLCJDb21wb25lbnQiLCJNYXJpb25ldHRlIiwiVmlldyIsIkJlaGF2aW9yIiwicHJvdG90eXBlIiwiX29wdGlvbnMiLCJtYXBTdGF0ZSIsIm1hcFN0YXRlVG9Qcm9wcyIsImRlZmF1bHRNYXBTdGF0ZVRvUHJvcHMiLCJtYXBEaXNwYXRjaCIsIm1hcERpc3BhdGNoVG9Qcm9wcyIsImRlZmF1bHRNYXBEaXNwYXRjaFRvUHJvcHMiLCJtZXJnZVByb3BzIiwiZGVmYXVsdE1lcmdlUHJvcHMiLCJwcm9wcyIsInN0b3JlIiwid2luZG93Iiwic3RvcmVTdGF0ZSIsImdldFN0YXRlIiwiZGVmYXVsdHMiLCJnZXRJbml0aWFsU3RhdGUiLCJiaW5kU3RhdGVFdmVudHMiLCJjbGVhckNhY2hlIiwiaXNEaXNwbGF5Q29tcG9uZW50IiwidHJ5U3Vic2NyaWJlIiwiYmluZCIsInN0YXRlRXZlbnRzIiwiYmluZEV2ZW50cyIsImJpbmRFbnRpdHlFdmVudHMiLCJ1bmJpbmQiLCJ1bmJpbmRFdmVudHMiLCJ1bmJpbmRFbnRpdHlFdmVudHMiLCJmaW5hbE1hcFN0YXRlVG9Qcm9wcyIsImNvbmZpZ3VyZUZpbmFsTWFwU3RhdGUiLCJkb1N0YXRlUHJvcHNEZXBlbmRPbk93blByb3BzIiwibWFwcGVkU3RhdGUiLCJpc0ZhY3RvcnkiLCJpc0Z1bmN0aW9uIiwiY29tcHV0ZVN0YXRlUHJvcHMiLCJuZXh0U3RhdGVQcm9wcyIsImZpbmFsTWFwRGlzcGF0Y2hUb1Byb3BzIiwiY29uZmlndXJlRmluYWxNYXBEaXNwYXRjaCIsImRvRGlzcGF0Y2hQcm9wc0RlcGVuZE9uT3duUHJvcHMiLCJtYXBwZWREaXNwYXRjaCIsImNvbXB1dGVEaXNwYXRjaFByb3BzIiwibmV4dERpc3BhdGNoUHJvcHMiLCJ1bnN1YnNjcmliZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmliZSIsImhhbmRsZUNoYW5nZSIsImhhbmRsZURpc3BhdGNoUHJvcHMiLCJ0cnlVbnN1YnNjcmliZSIsInVuYmluZFN0YXRlRXZlbnRzIiwiaGF2ZUluaXRpYWxTdGF0ZVByb3BzQmVlbkRldGVybWluZWQiLCJoYXZlSW5pdGlhbERpc3BhdGNoUHJvcHNCZWVuRGV0ZXJtaW5lZCIsInVwZGF0ZURpc3BhdGNoUHJvcHNJZk5lZWRlZCIsInByZXZTdG9yZVN0YXRlIiwiaGF2ZVN0YXRlUHJvcHNDaGFuZ2VkIiwidXBkYXRlU3RhdGVQcm9wc0lmTmVlZGVkIiwibWVyZ2VkUHJvcHMiLCJjb21wb25lbnREaWRSZWNlaXZlUHJvcHMiLCJzZXRTdGF0ZSIsIl9tYXBTdGF0ZVRvUHJvcHMiLCJfbWFwRGlzcGF0Y2hUb1Byb3BzIiwiX21lcmdlUHJvcHMiLCJjb21wb25lbnRJbml0aWFsaXplIiwiaW5pdGlhbGl6ZSIsImNvbXBvbmVudG9uUmVuZGVyIiwib25SZW5kZXIiLCJjb21wb25lbnRPbkRlc3Ryb3kiLCJvbkRlc3Ryb3kiLCJjb25uZWN0TWl4aW4iLCJfaW5pdE9wdGlvbnMiLCJpbml0T3B0aW9ucyIsImNhbGwiLCJhcHBseSIsImFyZ3VtZW50cyIsIm1peGluIiwib21pdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4QkFBZTtTQUFVLEVBQVY7Q0FBZjs7QUNBQSxpQ0FBZTtTQUFhLEVBQUVBLGtCQUFGLEVBQWI7Q0FBZjs7QUNDQSx5QkFBZSxVQUFDQyxVQUFELEVBQWFDLGFBQWIsRUFBNEJDLFdBQTVCO1NBQ2JDLEVBQUVDLE1BQUYsQ0FB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